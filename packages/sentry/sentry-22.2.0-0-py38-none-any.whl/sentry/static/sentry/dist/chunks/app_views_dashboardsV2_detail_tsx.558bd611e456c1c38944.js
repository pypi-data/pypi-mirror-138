"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_views_dashboardsV2_detail_tsx"],{"./app/views/dashboardsV2/data.tsx":(e,t,i)=>{i.d(t,{R7:()=>r,CS:()=>o,L3:()=>n,GY:()=>l});var a=i("./app/locale.tsx"),s=i("./app/utils/guid.tsx"),d=i("./app/views/dashboardsV2/types.tsx");const r={id:"",dateCreated:"",createdBy:void 0,title:(0,a.t)("Untitled dashboard"),widgets:[]},o=[{id:"default-template",dateCreated:"",createdBy:void 0,title:(0,a.t)("General Template"),description:(0,a.t)("Various Frontend and Backend Widgets"),widgets:[{title:(0,a.t)("Number of Errors"),displayType:d.FO.BIG_NUMBER,interval:"5m",queries:[{name:"",fields:["count()"],conditions:"!event.type:transaction",orderby:"count()"}],widgetType:d.l9.DISCOVER,tempId:(0,s.E)()},{title:(0,a.t)("Number of Issues"),displayType:d.FO.BIG_NUMBER,interval:"5m",queries:[{name:"",fields:["count_unique(issue)"],conditions:"!event.type:transaction",orderby:"count_unique(issue)"}],widgetType:d.l9.DISCOVER,tempId:(0,s.E)()},{title:(0,a.t)("Events"),displayType:d.FO.LINE,interval:"5m",queries:[{name:(0,a.t)("Events"),fields:["count()"],conditions:"!event.type:transaction",orderby:"count()"}],widgetType:d.l9.DISCOVER,tempId:(0,s.E)()},{title:(0,a.t)("Affected Users"),displayType:d.FO.LINE,interval:"5m",queries:[{name:(0,a.t)("Known Users"),fields:["count_unique(user)"],conditions:"has:user.email !event.type:transaction",orderby:"count_unique(user)"},{name:(0,a.t)("Anonymous Users"),fields:["count_unique(user)"],conditions:"!has:user.email !event.type:transaction",orderby:"count_unique(user)"}],widgetType:d.l9.DISCOVER,tempId:(0,s.E)()},{title:(0,a.t)("Handled vs. Unhandled"),displayType:d.FO.LINE,interval:"5m",queries:[{name:(0,a.t)("Handled"),fields:["count()"],conditions:"error.handled:true",orderby:"count()"},{name:(0,a.t)("Unhandled"),fields:["count()"],conditions:"error.handled:false",orderby:"count()"}],widgetType:d.l9.DISCOVER,tempId:(0,s.E)()},{title:(0,a.t)("Errors by Country"),displayType:d.FO.WORLD_MAP,interval:"5m",queries:[{name:(0,a.t)("Error counts"),fields:["count()"],conditions:"!event.type:transaction has:geo.country_code",orderby:"count()"}],widgetType:d.l9.DISCOVER,tempId:(0,s.E)()},{title:(0,a.t)("High Throughput Transactions"),displayType:d.FO.TABLE,interval:"5m",queries:[{name:"",fields:["count()","transaction"],conditions:"!event.type:error",orderby:"-count"}],widgetType:d.l9.DISCOVER,tempId:(0,s.E)()},{title:(0,a.t)("Errors by Browser"),displayType:d.FO.TABLE,interval:"5m",queries:[{name:"",fields:["browser.name","count()"],conditions:"!event.type:transaction has:browser.name",orderby:"-count"}],widgetType:d.l9.DISCOVER,tempId:(0,s.E)()},{title:(0,a.t)("Overall User Misery"),displayType:d.FO.BIG_NUMBER,interval:"5m",queries:[{name:"",fields:["user_misery(300)"],conditions:"",orderby:""}],widgetType:d.l9.DISCOVER,tempId:(0,s.E)()},{title:(0,a.t)("High Throughput Transactions"),displayType:d.FO.TOP_N,interval:"5m",queries:[{name:"",fields:["transaction","count()"],conditions:"!event.type:error",orderby:"-count"}],widgetType:d.l9.DISCOVER,tempId:(0,s.E)()},{title:(0,a.t)("Issues Assigned to Me or My Teams"),displayType:d.FO.TABLE,interval:"5m",queries:[{name:"",fields:["assignee","issue","title"],conditions:"assigned_or_suggested:me is:unresolved",orderby:"priority"}],widgetType:d.l9.ISSUE,tempId:(0,s.E)()},{title:(0,a.t)("Transactions Ordered by Misery"),displayType:d.FO.TABLE,interval:"5m",queries:[{name:"",fields:["transaction","user_misery(300)"],conditions:"",orderby:"-user_misery_300"}],widgetType:d.l9.DISCOVER,tempId:(0,s.E)()}]},{id:"frontend-template",title:(0,a.t)("Frontend Template"),dateCreated:"",createdBy:void 0,description:(0,a.t)("Erroring URLs and Web Vitals"),widgets:[{title:(0,a.t)("Top 5 Issues by Unique Users Over Time"),displayType:d.FO.TOP_N,interval:"5m",queries:[{name:"",fields:["issue","count_unique(user)"],conditions:"",orderby:"-count_unique_user"}],widgetType:d.l9.DISCOVER,tempId:(0,s.E)()},{title:(0,a.t)("Errors by Browser as Percentage"),displayType:d.FO.AREA,interval:"5m",queries:[{name:"",fields:["equation|count_if(browser.name,equals,Chrome)/count() * 100","equation|count_if(browser.name,equals,Firefox)/count() * 100","equation|count_if(browser.name,equals,Safari)/count() * 100"],conditions:"has:browser.name",orderby:""}],widgetType:d.l9.DISCOVER,tempId:(0,s.E)()},{title:(0,a.t)("Issues Assigned to Me or My Teams"),displayType:d.FO.TABLE,interval:"5m",queries:[{name:"",fields:["assignee","issue","title"],conditions:"assigned_or_suggested:me is:unresolved",orderby:"priority"}],widgetType:d.l9.ISSUE,tempId:(0,s.E)()},{title:(0,a.t)("Top 5 Issues by Unique Users"),displayType:d.FO.TABLE,interval:"5m",queries:[{name:"",fields:["issue","count_unique(user)","title"],conditions:"",orderby:"-count_unique_user"}],widgetType:d.l9.DISCOVER,tempId:(0,s.E)()},{title:(0,a.t)("URLs grouped by Issue"),displayType:d.FO.TABLE,interval:"5m",queries:[{name:"",fields:["http.url","issue","count_unique(user)"],conditions:"event.type:error",orderby:"-count_unique_user"}],widgetType:d.l9.DISCOVER,tempId:(0,s.E)()},{title:(0,a.t)("Transactions 404ing"),displayType:d.FO.TABLE,interval:"5m",queries:[{name:"",fields:["transaction","count()"],conditions:"transaction.status:not_found",orderby:"-count"}],widgetType:d.l9.DISCOVER,tempId:(0,s.E)()},{title:(0,a.t)("Layout Shift Over Time"),displayType:d.FO.LINE,interval:"5m",queries:[{name:"",fields:["p75(measurements.cls)"],conditions:"",orderby:""}],widgetType:d.l9.DISCOVER,tempId:(0,s.E)()},{title:(0,a.t)("LCP by Country"),displayType:d.FO.WORLD_MAP,interval:"5m",queries:[{name:"",fields:["p75(measurements.lcp)"],conditions:"has:geo.country_code",orderby:""}],widgetType:d.l9.DISCOVER,tempId:(0,s.E)()},{title:(0,a.t)("Page Load Over Time"),displayType:d.FO.LINE,interval:"5m",queries:[{name:"",fields:["p75(measurements.lcp)","p75(measurements.fcp)"],conditions:"transaction.op:pageload",orderby:""}],widgetType:d.l9.DISCOVER,tempId:(0,s.E)()},{title:(0,a.t)("Slowest Pageloads"),displayType:d.FO.TABLE,interval:"5m",queries:[{name:"",fields:["transaction","count()"],conditions:"transaction.op:pageload p75(measurements.lcp):>4s",orderby:"-count"}],widgetType:d.l9.DISCOVER,tempId:(0,s.E)()},{title:(0,a.t)("Overall LCP"),displayType:d.FO.BIG_NUMBER,interval:"5m",queries:[{name:"",fields:["p75(measurements.lcp)"],conditions:"",orderby:""}],widgetType:d.l9.DISCOVER,tempId:(0,s.E)()},{title:(0,a.t)("Slow Page Navigations"),displayType:d.FO.TABLE,interval:"5m",queries:[{name:"",fields:["transaction","count()"],conditions:"transaction.duration:>2s",orderby:"-count"}],widgetType:d.l9.DISCOVER,tempId:(0,s.E)()},{title:(0,a.t)("Overall FCP"),displayType:d.FO.BIG_NUMBER,interval:"5m",queries:[{name:"",fields:["p75(measurements.fcp)"],conditions:"",orderby:""}],widgetType:d.l9.DISCOVER,tempId:(0,s.E)()}]},{id:"backend-template",title:(0,a.t)("Backend Template"),dateCreated:"",createdBy:void 0,description:(0,a.t)("Issues and Performance"),widgets:[{title:(0,a.t)("Top 5 Issues by Unique Users Over Time"),displayType:d.FO.TOP_N,interval:"5m",queries:[{name:"",fields:["issue","count_unique(user)"],conditions:"",orderby:"-count_unique_user"}],widgetType:d.l9.DISCOVER,tempId:(0,s.E)()},{title:(0,a.t)("Transactions Erroring Over Time"),displayType:d.FO.TOP_N,interval:"5m",queries:[{name:"",fields:["transaction","count()"],conditions:"transaction.status:internal_error",orderby:"-count"}],widgetType:d.l9.DISCOVER,tempId:(0,s.E)()},{title:(0,a.t)("Erroring Transactions by Percentage"),displayType:d.FO.TABLE,interval:"5m",queries:[{name:"",fields:["equation|count_if(transaction.status,equals,internal_error) / count() * 100","transaction","count_if(transaction.status,equals,internal_error)","count()"],conditions:"count():>100",orderby:"-equation[0]"}],widgetType:d.l9.DISCOVER,tempId:(0,s.E)()},{title:(0,a.t)("Top 5 Issues by Unique Users"),displayType:d.FO.TABLE,interval:"5m",queries:[{name:"",fields:["issue","count_unique(user)","title"],conditions:"",orderby:"-count_unique_user"}],widgetType:d.l9.DISCOVER,tempId:(0,s.E)()},{title:(0,a.t)("Transactions Erroring"),displayType:d.FO.TABLE,interval:"5m",queries:[{name:"",fields:["count()","transaction"],conditions:"transaction.status:internal_error",orderby:"-count"}],widgetType:d.l9.DISCOVER,tempId:(0,s.E)()},{title:(0,a.t)("Issues Assigned to Me or My Teams"),displayType:d.FO.TABLE,interval:"5m",queries:[{name:"",fields:["assignee","issue","title"],conditions:"assigned_or_suggested:me is:unresolved",orderby:"priority"}],widgetType:d.l9.ISSUE,tempId:(0,s.E)()},{title:(0,a.t)("p75 of Duration by Country"),displayType:d.FO.WORLD_MAP,interval:"5m",queries:[{name:"",fields:["p75(transaction.duration)"],conditions:"",orderby:""}],widgetType:d.l9.DISCOVER,tempId:(0,s.E)()},{title:(0,a.t)("p75 Over Time"),displayType:d.FO.LINE,interval:"5m",queries:[{name:"",fields:["p75(transaction.duration)"],conditions:"",orderby:""}],widgetType:d.l9.DISCOVER,tempId:(0,s.E)()},{title:(0,a.t)("Throughput (Events Per Minute)"),displayType:d.FO.LINE,interval:"5m",queries:[{name:"Transactions",fields:["epm()"],conditions:"event.type:transaction",orderby:""},{name:"Errors",fields:["epm()"],conditions:"event.type:error",orderby:""}],widgetType:d.l9.DISCOVER,tempId:(0,s.E)()},{title:(0,a.t)("Tasks Transactions with Poor Apdex"),displayType:d.FO.TABLE,interval:"5m",queries:[{name:"",fields:["count()","transaction"],conditions:"apdex():<0.5 transaction.op:*task*",orderby:"-count"}],widgetType:d.l9.DISCOVER,tempId:(0,s.E)()},{title:(0,a.t)("HTTP Transactions with Poor Apdex"),displayType:d.FO.TABLE,interval:"5m",queries:[{name:"",fields:["epm()","http.method","http.status_code","transaction"],conditions:"apdex():<0.5 transaction.op:*http* has:http.method has:http.status_code",orderby:"-epm"}],widgetType:d.l9.DISCOVER,tempId:(0,s.E)()},{title:(0,a.t)("Overall Apdex"),displayType:d.FO.BIG_NUMBER,interval:"5m",queries:[{name:"",fields:["apdex(300)"],conditions:"",orderby:""}],widgetType:d.l9.DISCOVER,tempId:(0,s.E)()},{title:(0,a.t)("Overall p75"),displayType:d.FO.BIG_NUMBER,interval:"5m",queries:[{name:"",fields:["p75(transaction.duration)"],conditions:"",orderby:""}],widgetType:d.l9.DISCOVER,tempId:(0,s.E)()}]},{id:"mobile-template",title:(0,a.t)("Mobile Template"),dateCreated:"",createdBy:void 0,description:(0,a.t)("Crash Details and Performance Vitals"),widgets:[{title:(0,a.t)("Total Crashes"),displayType:d.FO.BIG_NUMBER,interval:"5m",queries:[{name:"",fields:["count()"],conditions:"error.handled:false event.type:error",orderby:""}],widgetType:d.l9.DISCOVER,tempId:(0,s.E)()},{title:(0,a.t)("Unique Users Who Crashed"),displayType:d.FO.BIG_NUMBER,interval:"5m",queries:[{name:"",fields:["count_unique(user)"],conditions:"error.handled:false event.type:error",orderby:""}],widgetType:d.l9.DISCOVER,tempId:(0,s.E)()},{title:(0,a.t)("Overall Number of Errors"),displayType:d.FO.BIG_NUMBER,interval:"5m",queries:[{name:"",fields:["count()"],conditions:"event.type:error",orderby:""}],widgetType:d.l9.DISCOVER,tempId:(0,s.E)()},{title:(0,a.t)("Issues Causing Crashes"),displayType:d.FO.TABLE,interval:"5m",queries:[{name:"",fields:["issue","count()","count_unique(user)"],conditions:"error.handled:false",orderby:"-count_unique_user"}],widgetType:d.l9.DISCOVER,tempId:(0,s.E)()},{title:(0,a.t)("Crashes Over Time"),displayType:d.FO.LINE,interval:"5m",queries:[{name:(0,a.t)("Crashes"),fields:["count()","count_unique(user)"],conditions:"error.handled:false",orderby:""}],widgetType:d.l9.DISCOVER,tempId:(0,s.E)()},{title:(0,a.t)("Crashes by OS"),displayType:d.FO.TABLE,interval:"5m",queries:[{name:"",fields:["os","count()"],conditions:"has:os error.handled:false",orderby:"-count"}],widgetType:d.l9.DISCOVER,tempId:(0,s.E)()},{title:(0,a.t)("Overall Warm Startup Time"),displayType:d.FO.BIG_NUMBER,interval:"5m",queries:[{name:"",fields:["p75(measurements.app_start_warm)"],conditions:"has:measurements.app_start_warm",orderby:""}],widgetType:d.l9.DISCOVER,tempId:(0,s.E)()},{title:(0,a.t)("Overall Cold Startup Time"),displayType:d.FO.BIG_NUMBER,interval:"5m",queries:[{name:"",fields:["p75(measurements.app_start_cold)"],conditions:"has:measurements.app_start_cold",orderby:""}],widgetType:d.l9.DISCOVER,tempId:(0,s.E)()},{title:(0,a.t)("Overall Throughput"),displayType:d.FO.BIG_NUMBER,interval:"5m",queries:[{name:"",fields:["epm()"],conditions:"",orderby:""}],widgetType:d.l9.DISCOVER,tempId:(0,s.E)()},{title:(0,a.t)("Warm Startup Times"),displayType:d.FO.TABLE,interval:"5m",queries:[{name:"",fields:["transaction","p75(measurements.app_start_warm)"],conditions:"has:measurements.app_start_warm",orderby:""}],widgetType:d.l9.DISCOVER,tempId:(0,s.E)()},{title:(0,a.t)("Cold Startup Times"),displayType:d.FO.TABLE,interval:"5m",queries:[{name:"",fields:["transaction","p75(measurements.app_start_cold)"],conditions:"has:measurements.app_start_cold",orderby:""}],widgetType:d.l9.DISCOVER,tempId:(0,s.E)()},{title:(0,a.t)("Throughput Over Time"),displayType:d.FO.LINE,interval:"5m",queries:[{name:"",fields:["epm()"],conditions:"",orderby:""}],widgetType:d.l9.DISCOVER,tempId:(0,s.E)()},{title:(0,a.t)("Frozen Frames Over Time"),displayType:d.FO.BIG_NUMBER,interval:"5m",queries:[{name:"",fields:["p75(measurements.frames_frozen_rate)"],conditions:"",orderby:""}],widgetType:d.l9.DISCOVER,tempId:(0,s.E)()},{title:(0,a.t)("Frozen Frames Rate"),displayType:d.FO.TABLE,interval:"5m",queries:[{name:"",fields:["transaction","p75(measurements.frames_frozen_rate)"],conditions:"has:measurements.frames_frozen_rate",orderby:"-p75_measurements_frames_frozen_rate"}],widgetType:d.l9.DISCOVER,tempId:(0,s.E)()}]}],n=[{label:(0,a.t)("Area Chart"),value:"area"},{label:(0,a.t)("Bar Chart"),value:"bar"},{label:(0,a.t)("Line Chart"),value:"line"},{label:(0,a.t)("Table"),value:"table"},{label:(0,a.t)("World Map"),value:"world_map"},{label:(0,a.t)("Big Number"),value:"big_number"},{label:(0,a.t)("Top 5 Events"),value:"top_n"}],l=((0,a.t)("1 Minute"),(0,a.t)("5 Minutes"),(0,a.t)("15 Minutes"),(0,a.t)("30 Minutes"),(0,a.t)("1 Hour"),(0,a.t)("1 Day"),"24h")},"./app/views/dashboardsV2/detail.tsx":(e,t,i)=>{i.d(t,{Z:()=>ee});var a=i("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),s=i("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),d=(i("../node_modules/core-js/modules/web.dom-collections.iterator.js"),i("../node_modules/core-js/modules/es.string.replace.js"),i("../node_modules/react/index.js")),r=i("../node_modules/react-router/es/index.js"),o=i("../node_modules/lodash/isEqual.js"),n=i.n(o),l=i("../node_modules/lodash/omit.js"),p=i.n(l),u=i("./app/actionCreators/dashboards.tsx"),h=i("./app/actionCreators/indicator.tsx"),c=i("./app/actionCreators/modal.tsx"),m=i("./app/components/breadcrumbs.tsx"),y=i("./app/components/hookOrDefault.tsx"),b=i("./app/components/layouts/thirds.tsx"),g=i("./app/components/noProjectMessage.tsx"),E=i("./app/components/organizations/pageFilters/container.tsx"),T=i("./app/components/sentryDocumentTitle.tsx"),v=i("./app/locale.tsx"),I=i("./app/styles/organization.tsx"),f=i("./app/styles/space.tsx"),w=i("./app/utils.tsx"),D=i("./app/utils/analytics.tsx"),_=i("./app/utils/analytics/trackAdvancedAnalyticsEvent.tsx"),O=i("./app/utils/withApi.tsx"),S=i("./app/utils/withOrganization.tsx"),C=i("./app/components/acl/feature.tsx"),R=i("./app/components/acl/featureDisabled.tsx"),q=i("./app/components/button.tsx"),B=i("./app/components/buttonBar.tsx"),Z=i("./app/components/confirm.tsx"),V=i("./app/components/hovercard.tsx"),U=i("./app/components/tooltip.tsx"),L=i("./app/icons/index.tsx"),W=i("./app/views/dashboardsV2/types.tsx"),F=i("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class x extends d.Component{renderCancelButton(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,v.t)("Cancel");const{onCancel:t}=this.props;return(0,F.tZ)(q.ZP,{"data-test-id":"dashboard-cancel",onClick:e=>{e.preventDefault(),t()},children:e})}render(){const{organization:e,dashboardState:t,dashboards:i,widgetLimitReached:a,onEdit:s,onCommit:r,onDelete:o,onAddWidget:n}=this.props;return[W.n3.EDIT,W.n3.PENDING_DELETE].includes(t)?(0,F.BX)(N,{gap:1,children:[this.renderCancelButton(),(0,F.tZ)(Z.Z,{priority:"danger",message:(0,v.t)("Are you sure you want to delete this dashboard?"),onConfirm:o,disabled:i.length<=1,children:(0,F.tZ)(q.ZP,{"data-test-id":"dashboard-delete",priority:"danger",children:(0,v.t)("Delete")})}),(0,F.tZ)(q.ZP,{"data-test-id":"dashboard-commit",onClick:e=>{e.preventDefault(),r()},priority:"primary",children:(0,v.t)("Save and Finish")})]},"edit-controls"):t===W.n3.CREATE?(0,F.BX)(N,{gap:1,children:[this.renderCancelButton(),(0,F.tZ)(q.ZP,{"data-test-id":"dashboard-commit",onClick:e=>{e.preventDefault(),r()},priority:"primary",children:(0,v.t)("Save and Finish")})]},"create-controls"):t===W.n3.PREVIEW?(0,F.BX)(N,{gap:1,children:[this.renderCancelButton((0,v.t)("Go Back")),(0,F.tZ)(q.ZP,{"data-test-id":"dashboard-commit",onClick:e=>{e.preventDefault(),r()},priority:"primary",children:(0,v.t)("Add Dashboard")})]},"preview-controls"):(0,F.tZ)(N,{gap:1,children:(0,F.tZ)(A,{children:t=>(0,F.BX)(d.Fragment,{children:[(0,F.tZ)(q.ZP,{"data-test-id":"dashboard-edit",onClick:e=>{e.preventDefault(),s()},icon:(0,F.tZ)(L.yl,{}),disabled:!t,priority:e.features.includes("widget-library")?"default":"primary",children:(0,v.t)("Edit Dashboard")}),e.features.includes("widget-library")&&t?(0,F.tZ)(U.Z,{title:(0,v._N)("Max widgets ([maxWidgets]) per dashboard reached.",{maxWidgets:W.ZU}),disabled:!a,children:(0,F.tZ)(q.ZP,{"data-test-id":"add-widget-library",priority:"primary",disabled:a,icon:(0,F.tZ)(L.N_,{isCircled:!0}),onClick:()=>{(0,_.Z)("dashboards_views.widget_library.opened",{organization:e}),n()},children:(0,v.t)("Add Widget")})}):null]})})},"controls")}}x.displayName="Controls";const A=e=>{let{children:t}=e;const i=(0,v.t)("Requires dashboard editing.");return(0,F.tZ)(C.Z,{hookName:"feature-disabled:dashboards-edit",features:["organizations:dashboards-edit"],renderDisabled:e=>(0,F.tZ)(V.uI,{body:(0,F.tZ)(R.Z,{features:e.features,hideHelpToggle:!0,message:i,featureName:i}),children:e.children(e)}),children:e=>{let{hasFeature:i}=e;return t(i)}})};A.displayName="DashboardEditFeature";const N=(0,s.Z)(B.ZP,{target:"e78awt50"})("@media (max-width: ",(e=>e.theme.breakpoints[0]),"){grid-auto-flow:row;grid-row-gap:",(0,f.Z)(1),";width:100%;}"),z=x;var P=i("./app/views/dashboardsV2/dashboard.tsx"),M=i("./app/views/dashboardsV2/data.tsx"),k=i("./app/views/dashboardsV2/layoutUtils.tsx"),G=i("./app/components/editableText.tsx");function $(e){let{dashboard:t,isEditing:i,organization:a,onUpdate:s}=e;return(0,F.tZ)("div",{children:t?(0,F.tZ)(G.Z,{isDisabled:!i,value:a.features.includes("dashboards-edit")&&"default-overview"===t.id?"Default Dashboard":t.title,onChange:e=>s({...t,title:e}),errorMessage:(0,v.t)("Please set a title for this dashboard"),autoSelect:!0}):(0,v.t)("Dashboards")})}$.displayName="DashboardTitle";const j=(0,S.Z)($);var H=i("./app/views/dashboardsV2/utils.tsx");const X=(0,v.t)("You have unsaved changes, are you sure you want to leave?"),K=(0,y.Z)({hookName:"component:dashboards-header"});class Y extends d.Component{constructor(){super(...arguments),(0,a.Z)(this,"state",{dashboardState:this.props.initialState,modifiedDashboard:this.updateModifiedDashboard(this.props.initialState),widgetLimitReached:this.props.dashboard.widgets.length>=W.ZU}),(0,a.Z)(this,"onEdit",(()=>{const{dashboard:e}=this.props;(0,D.ec)({eventKey:"dashboards2.edit.start",eventName:"Dashboards2: Edit start",organization_id:parseInt(this.props.organization.id,10)}),this.setState({dashboardState:W.n3.EDIT,modifiedDashboard:(0,H.qk)(e)})})),(0,a.Z)(this,"onRouteLeave",(()=>{const{dashboard:e}=this.props,{modifiedDashboard:t}=this.state;if(![W.n3.VIEW,W.n3.PENDING_DELETE,W.n3.PREVIEW].includes(this.state.dashboardState)&&!n()(t,e))return X})),(0,a.Z)(this,"onUnload",(e=>{const{dashboard:t}=this.props,{modifiedDashboard:i}=this.state;[W.n3.VIEW,W.n3.PENDING_DELETE,W.n3.PREVIEW].includes(this.state.dashboardState)||n()(i,t)||(e.preventDefault(),e.returnValue=X)})),(0,a.Z)(this,"onDelete",(e=>()=>{const{api:t,organization:i,location:a}=this.props;if(null==e||!e.id)return;const s=this.state.dashboardState;this.setState({dashboardState:W.n3.PENDING_DELETE},(()=>{(0,u.iM)(t,i.slug,e.id).then((()=>{(0,h.S9)((0,v.t)("Dashboard deleted")),(0,D.ec)({eventKey:"dashboards2.delete",eventName:"Dashboards2: Delete",organization_id:parseInt(this.props.organization.id,10)}),r.browserHistory.replace({pathname:`/organizations/${i.slug}/dashboards/`,query:a.query})})).catch((()=>{this.setState({dashboardState:s})}))}))})),(0,a.Z)(this,"onCancel",(()=>{const{organization:e,dashboard:t,location:i,params:a}=this.props,{modifiedDashboard:s}=this.state;let d=!n()(s,t);if(t.widgets.every((e=>{let{layout:t}=e;return!(0,w.ri)(t)}))&&(d=!n()({...s,widgets:null==s?void 0:s.widgets.map((e=>p()(e,"layout")))},{...t,widgets:t.widgets.map((e=>p()(e,"layout")))})),!d||this.isPreview||confirm(X)){if(a.dashboardId)return(0,D.ec)({eventKey:"dashboards2.edit.cancel",eventName:"Dashboards2: Edit cancel",organization_id:parseInt(this.props.organization.id,10)}),void this.setState({dashboardState:W.n3.VIEW,modifiedDashboard:null});(0,D.ec)({eventKey:"dashboards2.create.cancel",eventName:"Dashboards2: Create cancel",organization_id:parseInt(this.props.organization.id,10)}),r.browserHistory.replace({pathname:`/organizations/${e.slug}/dashboards/`,query:i.query})}})),(0,a.Z)(this,"handleUpdateWidgetList",(e=>{const{organization:t,dashboard:i,api:a,onDashboardUpdate:s,location:d}=this.props,{modifiedDashboard:o}=this.state,n=(0,k.RI)(e),l=(0,k.Sp)(n),p={...(0,H.qk)(o||i),widgets:(0,k._F)(e,l)};this.setState({modifiedDashboard:p,widgetLimitReached:e.length>=W.ZU}),this.isEditing||this.isPreview||(0,u.Y)(a,t.slug,p).then((e=>{s&&(s(e),this.setState({modifiedDashboard:null})),(0,h.S9)((0,v.t)("Dashboard updated")),i&&e.id!==i.id&&r.browserHistory.replace({pathname:`/organizations/${t.slug}/dashboard/${e.id}/`,query:{...d.query}})}),(()=>{}))})),(0,a.Z)(this,"handleAddCustomWidget",(e=>{const{dashboard:t}=this.props,{modifiedDashboard:i}=this.state,a=i||t;this.onUpdateWidget([...a.widgets,e])})),(0,a.Z)(this,"onAddWidget",(()=>{const{organization:e,dashboard:t}=this.props;this.setState({modifiedDashboard:(0,H.qk)(t)}),(0,c.openAddDashboardWidgetModal)({organization:e,dashboard:t,onAddLibraryWidget:e=>this.handleUpdateWidgetList(e),source:W.EN.LIBRARY})})),(0,a.Z)(this,"onCommit",(()=>{const{api:e,organization:t,location:i,dashboard:a,onDashboardUpdate:s}=this.props,{modifiedDashboard:d,dashboardState:o}=this.state;switch(o){case W.n3.PREVIEW:case W.n3.CREATE:d&&(this.isPreview&&(0,_.Z)("dashboards_manage.templates.add",{organization:t,dashboard_id:a.id,dashboard_title:a.title,was_previewed:!0}),(0,u.JR)(e,t.slug,d,this.isPreview).then((e=>{(0,h.S9)((0,v.t)("Dashboard created")),(0,D.ec)({eventKey:"dashboards2.create.complete",eventName:"Dashboards2: Create complete",organization_id:parseInt(t.id,10)}),this.setState({dashboardState:W.n3.VIEW}),r.browserHistory.replace({pathname:`/organizations/${t.slug}/dashboard/${e.id}/`,query:{...i.query}})}),(()=>{})));break;case W.n3.EDIT:if(d)return n()(a,d)?void this.setState({dashboardState:W.n3.VIEW,modifiedDashboard:null}):void(0,u.Y)(e,t.slug,d).then((e=>{s&&s(e),(0,h.S9)((0,v.t)("Dashboard updated")),(0,D.ec)({eventKey:"dashboards2.edit.complete",eventName:"Dashboards2: Edit complete",organization_id:parseInt(t.id,10)}),this.setState({dashboardState:W.n3.VIEW,modifiedDashboard:null}),a&&e.id!==a.id&&r.browserHistory.replace({pathname:`/organizations/${t.slug}/dashboard/${e.id}/`,query:{...i.query}})}),(()=>{}));this.setState({dashboardState:W.n3.VIEW,modifiedDashboard:null});break;case W.n3.VIEW:default:this.setState({dashboardState:W.n3.VIEW,modifiedDashboard:null})}})),(0,a.Z)(this,"setModifiedDashboard",(e=>{this.setState({modifiedDashboard:e})})),(0,a.Z)(this,"onSetWidgetToBeUpdated",(e=>{this.setState({widgetToBeUpdated:e})})),(0,a.Z)(this,"onUpdateWidget",(e=>{this.setState((t=>({...t,widgetToBeUpdated:void 0,widgetLimitReached:e.length>=W.ZU,modifiedDashboard:{...t.modifiedDashboard||this.props.dashboard,widgets:e}})),this.updateRouteAfterSavingWidget)}))}componentDidMount(){const{route:e,router:t}=this.props;this.checkStateRoute(),t.setRouteLeaveHook(e,this.onRouteLeave),window.addEventListener("beforeunload",this.onUnload)}componentDidUpdate(e){e.location.pathname!==this.props.location.pathname&&this.checkStateRoute()}componentWillUnmount(){window.removeEventListener("beforeunload",this.onUnload)}checkStateRoute(){const{organization:e,params:t}=this.props,{dashboardId:i}=t,a=`/organizations/${e.slug}/dashboard/${i}/`;location.pathname===a&&this.state.widgetToBeUpdated&&this.onSetWidgetToBeUpdated(void 0)}updateRouteAfterSavingWidget(){if(this.isWidgetBuilderRouter){const{router:e,organization:t,params:i}=this.props,{dashboardId:a}=i;if(a)return void e.replace(`/organizations/${t.slug}/dashboard/${a}/`);e.replace(`/organizations/${t.slug}/dashboards/new/`)}}updateModifiedDashboard(e){const{dashboard:t}=this.props;switch(e){case W.n3.PREVIEW:case W.n3.CREATE:case W.n3.EDIT:return(0,H.qk)(t);default:return null}}get isPreview(){const{dashboardState:e}=this.state;return W.n3.PREVIEW===e}get isEditing(){const{dashboardState:e}=this.state;return[W.n3.EDIT,W.n3.CREATE,W.n3.PENDING_DELETE].includes(e)}get isWidgetBuilderRouter(){const{location:e,params:t,organization:i}=this.props,{dashboardId:a,widgetId:s}=t;return[`/organizations/${i.slug}/dashboards/new/widget/new/`,`/organizations/${i.slug}/dashboard/${a}/widget/new/`,`/organizations/${i.slug}/dashboards/new/widget/${s}/edit/`,`/organizations/${i.slug}/dashboard/${a}/widget/${s}/edit/`].includes(e.pathname)}get dashboardTitle(){const{dashboard:e}=this.props,{modifiedDashboard:t}=this.state;return t?t.title:e.title}renderWidgetBuilder(e){const{children:t}=this.props,{modifiedDashboard:i,widgetToBeUpdated:a}=this.state;return(0,d.isValidElement)(t)?(0,d.cloneElement)(t,{dashboard:null!=i?i:e,onSave:this.onUpdateWidget,widget:a}):t}renderDefaultDashboardDetail(){const{organization:e,dashboard:t,dashboards:i,params:a,router:s,location:d}=this.props,{modifiedDashboard:r,dashboardState:o,widgetLimitReached:n}=this.state,{dashboardId:l}=a;return(0,F.tZ)(E.Z,{skipLoadLastUsed:e.features.includes("global-views"),defaultSelection:{datetime:{start:null,end:null,utc:!1,period:M.GY}},children:(0,F.tZ)(I.JH,{children:(0,F.BX)(g.Z,{organization:e,children:[(0,F.BX)(J,{children:[(0,F.tZ)(j,{dashboard:null!=r?r:t,onUpdate:this.setModifiedDashboard,isEditing:this.isEditing}),(0,F.tZ)(z,{organization:e,dashboards:i,onEdit:this.onEdit,onCancel:this.onCancel,onCommit:this.onCommit,onAddWidget:this.onAddWidget,onDelete:this.onDelete(t),dashboardState:o,widgetLimitReached:n})]}),(0,F.tZ)(K,{organization:e}),(0,F.tZ)(P.ZP,{paramDashboardId:l,dashboard:null!=r?r:t,organization:e,isEditing:this.isEditing,widgetLimitReached:n,onUpdate:this.onUpdateWidget,onSetWidgetToBeUpdated:this.onSetWidgetToBeUpdated,handleUpdateWidgetList:this.handleUpdateWidgetList,handleAddCustomWidget:this.handleAddCustomWidget,isPreview:this.isPreview,router:s,location:d})]})})})}getBreadcrumbLabel(){const{organization:e,dashboard:t}=this.props,{dashboardState:i}=this.state;let a=this.dashboardTitle;return i===W.n3.CREATE?a=(0,v.t)("Create Dashboard"):this.isPreview?a=(0,v.t)("Preview Dashboard"):e.features.includes("dashboards-edit")&&"default-overview"===t.id&&(a=(0,v.t)("Default Dashboard")),a}renderDashboardDetail(){const{organization:e,dashboard:t,dashboards:i,params:a,router:s,location:d,newWidget:r}=this.props,{modifiedDashboard:o,dashboardState:n,widgetLimitReached:l}=this.state,{dashboardId:p}=a;return(0,F.tZ)(T.Z,{title:t.title,orgSlug:e.slug,children:(0,F.tZ)(E.Z,{skipLoadLastUsed:e.features.includes("global-views"),defaultSelection:{datetime:{start:null,end:null,utc:!1,period:M.GY}},children:(0,F.tZ)(Q,{children:(0,F.BX)(g.Z,{organization:e,children:[(0,F.BX)(b.h4,{children:[(0,F.BX)(b.oB,{children:[(0,F.tZ)(m.Z,{crumbs:[{label:(0,v.t)("Dashboards"),to:`/organizations/${e.slug}/dashboards/`},{label:this.getBreadcrumbLabel()}]}),(0,F.tZ)(b.Dx,{children:(0,F.tZ)(j,{dashboard:null!=o?o:t,onUpdate:this.setModifiedDashboard,isEditing:this.isEditing})})]}),(0,F.tZ)(b.kP,{children:(0,F.tZ)(z,{organization:e,dashboards:i,onEdit:this.onEdit,onCancel:this.onCancel,onCommit:this.onCommit,onAddWidget:this.onAddWidget,onDelete:this.onDelete(t),dashboardState:n,widgetLimitReached:l})})]}),(0,F.tZ)(b.uT,{children:(0,F.tZ)(b.or,{fullWidth:!0,children:(0,F.tZ)(P.ZP,{paramDashboardId:p,dashboard:null!=o?o:t,organization:e,isEditing:this.isEditing,widgetLimitReached:l,onUpdate:this.onUpdateWidget,handleUpdateWidgetList:this.handleUpdateWidgetList,handleAddCustomWidget:this.handleAddCustomWidget,onSetWidgetToBeUpdated:this.onSetWidgetToBeUpdated,router:s,location:d,newWidget:r,isPreview:this.isPreview})})})]})})})})}render(){const{organization:e,dashboard:t}=this.props;return this.isWidgetBuilderRouter?this.renderWidgetBuilder(t):e.features.includes("dashboards-edit")?this.renderDashboardDetail():this.renderDefaultDashboardDetail()}}Y.displayName="DashboardDetail";const J=(0,s.Z)("div",{target:"e1anno2f1"})("display:grid;grid-template-columns:minmax(0, 1fr);grid-row-gap:",(0,f.Z)(2),";align-items:center;margin-bottom:",(0,f.Z)(2),";@media (min-width: ",(e=>e.theme.breakpoints[1]),"){grid-template-columns:minmax(0, 1fr) max-content;grid-column-gap:",(0,f.Z)(2),";height:40px;}"),Q=(0,s.Z)(I.JH,{target:"e1anno2f0"})({name:"1hcx8jb",styles:"padding:0"}),ee=(0,O.Z)((0,S.Z)(Y))}}]);
//# sourceMappingURL=../sourcemaps/app_views_dashboardsV2_detail_tsx.b6583372000df60f31a856f5fe26b80d.js.map