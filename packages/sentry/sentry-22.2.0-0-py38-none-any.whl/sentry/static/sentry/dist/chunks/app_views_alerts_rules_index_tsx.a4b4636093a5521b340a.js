"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_views_alerts_rules_index_tsx"],{"./app/views/alerts/alertBadge.tsx":(e,t,s)=>{s.d(t,{Z:()=>c});var a=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),r=s("./app/icons/index.tsx"),n=s("./app/locale.tsx"),i=s("./app/styles/space.tsx"),o=s("./app/views/alerts/types.tsx"),l=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function d(e){let{status:t,hideText:s=!1,isIssue:a}=e,i=(0,n.t)("Resolved"),d=r.DL,c="green300";return a?(i=(0,n.t)("Issue"),d=r.XI,c="gray300"):t===o.vt.CRITICAL?(i=(0,n.t)("Critical"),d=r.zC,c="red300"):t===o.vt.WARNING&&(i=(0,n.t)("Warning"),d=r.qV,c="yellow300"),(0,l.BX)(p,{"data-test-id":"alert-badge",displayFlex:!s,children:[(0,l.tZ)(u,{color:c,icon:d,children:(0,l.tZ)(d,{color:"white"})}),!s&&(0,l.tZ)(m,{color:c,children:i})]})}d.displayName="AlertBadge";const c=d,p=(0,a.Z)("div",{target:"e1ov36c52"})("display:",(e=>e.displayFlex?"flex":"block"),";align-items:center;"),u=(0,a.Z)("div",{target:"e1ov36c51"})("display:flex;align-items:center;justify-content:center;flex-shrink:0;left:3px;min-width:30px;&:before{content:'';position:absolute;width:28px;height:28px;border-radius:",(e=>e.theme.borderRadius),";background-color:",(e=>e.theme[e.color]),";transform:rotate(45deg);}svg{width:",(e=>e.icon===r.XI?"13px":"16px"),";z-index:1;}"),m=(0,a.Z)("div",{target:"e1ov36c50"})("margin-left:",(0,i.Z)(1.5),";")},"./app/views/alerts/rules/index.tsx":(e,t,s)=>{s.r(t),s.d(t,{default:()=>oe});var a=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),r=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),n=(s("../node_modules/core-js/modules/web.dom-collections.iterator.js"),s("../node_modules/react/index.js")),i=s("../node_modules/lodash/flatten.js"),o=s.n(i),l=s("./app/actionCreators/indicator.tsx"),d=s("./app/components/asyncComponent.tsx"),c=s("./app/components/layouts/thirds.tsx"),p=s("./app/components/links/externalLink.tsx"),u=s("./app/components/links/link.tsx"),m=s("./app/components/organizations/pageFilters/container.tsx"),h=s("./app/components/pagination.tsx"),g=s("./app/components/panels/index.tsx"),x=s("./app/components/searchBar.tsx"),Z=s("./app/components/sentryDocumentTitle.tsx"),v=s("./app/icons/index.tsx"),y=s("./app/locale.tsx"),w=s("./app/styles/space.tsx"),f=s("./app/utils/analytics.tsx"),b=s("./app/utils/projects.tsx"),I=s("./app/utils/teams.tsx"),q=s("./app/utils/withPageFilters.tsx"),C=s("./app/views/alerts/list/header.tsx"),A=s("./app/views/alerts/utils/index.tsx"),L=s("../node_modules/lodash/memoize.js"),T=s.n(L),_=s("./app/components/acl/access.tsx"),B=s("./app/components/avatar/actorAvatar.tsx"),j=s("./app/components/confirm.tsx"),z=s("./app/components/dateTime.tsx"),k=s("./app/components/dropdownMenuControlV2.tsx"),R=s("./app/components/errorBoundary.tsx"),S=s("./app/components/idBadge/index.tsx"),D=s("./app/components/timeSince.tsx"),E=s("./app/components/tooltip.tsx"),$=s("./app/styles/overflowEllipsis.tsx"),N=s("./app/utils/getDynamicText.tsx"),X=s("./app/views/alerts/incidentRules/types.tsx"),G=s("./app/views/alerts/alertBadge.tsx"),F=s("./app/views/alerts/types.tsx"),V=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const O=T()(((e,t)=>t.find((t=>t.slug===e))));function P(e){var t,s,a,r,n;let{rule:i,projectsLoaded:o,projects:l,orgId:d,onDelete:c,userTeams:p}=e;const u=void 0!==(null===(t=i.latestIncident)||void 0===t?void 0:t.status)&&[F.vt.CRITICAL,F.vt.WARNING].includes(i.latestIncident.status),m=i.projects[0],h=`/organizations/${d}/alerts/${(0,A.Gm)(i)?"rules":"metric-rules"}/${m}/${i.id}/`,g=`/organizations/${d}/alerts/rules/details/${i.id}/`,x=null===(s=i.owner)||void 0===s?void 0:s.split(":")[1],Z=x?{type:"team",id:x,name:""}:null,w=!x||p.has(x),f=(0,A.Gm)(i)?i.name:(0,V.tZ)(W,{to:(0,A.Gm)(i)?h:g,children:i.name}),b={[F.vt.CRITICAL]:(0,y.t)("Critical"),[F.vt.WARNING]:(0,y.t)("Warning"),[F.vt.CLOSED]:(0,y.t)("Resolved"),[F.vt.OPENED]:(0,y.t)("Resolved")},I=[{key:"edit",label:(0,y.t)("Edit"),leadingItems:(0,V.tZ)(v.yl,{}),to:h},{key:"delete",label:(0,y.t)("Delete"),leadingItems:(0,V.tZ)(v.Fz,{}),onAction:()=>{(0,j._)({onConfirm:()=>c(m,i),header:(0,y.t)("Delete Alert Rule?"),message:(0,y._N)("Are you sure you want to delete [name]? You won't be able to view the history of this alert once it's deleted.",{name:i.name}),confirmText:(0,y.t)("Delete Rule"),priority:"danger"})}}];return(0,V.BX)(R.Z,{children:[(0,V.BX)(K,{isIssueAlert:(0,A.Gm)(i),children:[(0,V.tZ)(M,{children:(0,V.tZ)(E.Z,{title:(0,A.Gm)(i)?(0,y.t)("Issue Alert"):(0,y._N)("Metric Alert Status: [status]",{status:b[null!==(a=null==i||null===(r=i.latestIncident)||void 0===r?void 0:r.status)&&void 0!==a?a:F.vt.CLOSED]}),children:(0,V.tZ)(G.Z,{status:null==i||null===(n=i.latestIncident)||void 0===n?void 0:n.status,isIssue:(0,A.Gm)(i),hideText:!0})})}),(0,V.BX)(U,{children:[(0,V.tZ)(Y,{children:f}),(0,V.tZ)(H,{children:!(0,A.Gm)(i)&&((0,A.Gm)(i)?null:i.latestIncident?u?(0,V.BX)("div",{children:[(0,y.t)("Triggered "),(0,V.tZ)(D.Z,{date:i.latestIncident.dateCreated})]}):(0,V.BX)("div",{children:[(0,y.t)("Resolved "),(0,V.tZ)(D.Z,{date:i.latestIncident.dateClosed})]}):"-")})]})]}),(0,V.tZ)(M,{children:function(){var e,t;if((0,A.Gm)(i))return null;const s=i.triggers.find((e=>{let{label:t}=e;return"critical"===t})),a=i.triggers.find((e=>{let{label:t}=e;return"warning"===t})),r=i.resolveThreshold,n=u&&(null===(e=i.latestIncident)||void 0===e?void 0:e.status)===F.vt.CRITICAL?s:null!=a?a:s;let o,l="green300",d=u&&i.thresholdType===X.lT.ABOVE?(0,y.t)("Above"):(0,y.t)("Below");return u?(l="critical"===(null==n?void 0:n.label)?"red300":"warning"===(null==n?void 0:n.label)?"yellow300":"green300",o=i.thresholdType===X.lT.ABOVE?"up":"down"):(o=i.thresholdType===X.lT.ABOVE?"down":"up",d=i.thresholdType===X.lT.ABOVE?(0,y.t)("Below"):(0,y.t)("Above")),(0,V.BX)(M,{children:[(0,V.tZ)(v.CC,{color:l,direction:o}),(0,V.tZ)(te,{children:`${d} ${i.latestIncident||!i.latestIncident&&!r?null==n||null===(t=n.alertThreshold)||void 0===t?void 0:t.toLocaleString():null==r?void 0:r.toLocaleString()}`})]})}()}),(0,V.tZ)(M,{children:(0,V.tZ)(J,{children:(0,V.tZ)(Q,{avatarSize:18,project:o?O(m,l):{slug:m}})})}),(0,V.tZ)(M,{children:Z?(0,V.tZ)(B.Z,{actor:Z,size:24}):"-"}),(0,V.tZ)(M,{children:(0,V.tZ)(ee,{date:(0,N.Z)({value:i.dateCreated,fixed:new Date("2021-04-20")}),format:"ll"})}),(0,V.tZ)(se,{children:(0,V.tZ)(_.Z,{access:["alerts:write"],children:e=>{let{hasAccess:t}=e;return(0,V.tZ)(k.Z,{items:I,placement:"bottom right",triggerProps:{"aria-label":(0,y.t)("Show more"),size:"xsmall",icon:(0,V.tZ)(v.YR,{size:"xs"}),showChevron:!1},disabledKeys:t&&w?[]:["delete"]})}})})]})}P.displayName="RuleListRow";const W=(0,r.Z)(u.Z,{target:"e1f6xqs310"})($.Z,";"),M=(0,r.Z)("div",{target:"e1f6xqs39"})({name:"s5xdrg",styles:"display:flex;align-items:center"}),K=(0,r.Z)(M,{target:"e1f6xqs38"})("position:relative;",(e=>e.isIssueAlert&&`padding: ${(0,w.Z)(3)} ${(0,w.Z)(2)}; line-height: 2.4;`),";"),U=(0,r.Z)("div",{target:"e1f6xqs37"})($.Z," margin-left:",(0,w.Z)(2),";line-height:1.35;"),Y=(0,r.Z)("div",{target:"e1f6xqs36"})($.Z," font-size:",(e=>e.theme.fontSizeLarge),";@media (max-width: ",(e=>e.theme.breakpoints[3]),"){max-width:300px;}@media (max-width: ",(e=>e.theme.breakpoints[2]),"){max-width:165px;}@media (max-width: ",(e=>e.theme.breakpoints[1]),"){max-width:100px;}"),H=(0,r.Z)("div",{target:"e1f6xqs35"})("color:",(e=>e.theme.gray300),";"),J=(0,r.Z)("div",{target:"e1f6xqs34"})({name:"1d3w5wq",styles:"width:100%"}),Q=(0,r.Z)(S.Z,{target:"e1f6xqs33"})({name:"ozd7xs",styles:"flex-shrink:0"}),ee=(0,r.Z)(z.Z,{target:"e1f6xqs32"})("font-variant-numeric:tabular-nums;color:",(e=>e.theme.gray300),";"),te=(0,r.Z)("div",{target:"e1f6xqs31"})("margin-left:",(0,w.Z)(1),";white-space:nowrap;font-variant-numeric:tabular-nums;"),se=(0,r.Z)(M,{target:"e1f6xqs30"})("justify-content:center;padding:",(0,w.Z)(1),";"),ae=P;var re=s("./app/views/alerts/rules/teamFilter.tsx");class ne extends d.Z{constructor(){super(...arguments),(0,a.Z)(this,"handleChangeFilter",((e,t)=>{const{router:s,location:a}=this.props,{cursor:r,page:n,...i}=a.query,o=[...t];s.push({pathname:a.pathname,query:{...i,team:o.length?o:""}})})),(0,a.Z)(this,"handleChangeSearch",(e=>{const{router:t,location:s}=this.props,{cursor:a,page:r,...n}=s.query;t.push({pathname:s.pathname,query:{...n,name:e}})})),(0,a.Z)(this,"handleDeleteRule",(async(e,t)=>{const{params:s}=this.props,{orgId:a}=s,r=(0,A.Gm)(t)?"rules":"alert-rules";try{await this.api.requestPromise(`/projects/${a}/${e}/${r}/${t.id}/`,{method:"DELETE"}),this.reloadData()}catch(e){(0,l.Iw)((0,y.t)("Error deleting rule"))}}))}getEndpoints(){const{params:e,location:t}=this.props,{query:s}=t;return s.expand=["latestIncident"],s.team=(0,re.L)(s.team),s.sort||(s.sort=["incident_status","date_triggered"]),[["ruleList",`/organizations/${e&&e.orgId}/combined-rules/`,{query:s}]]}renderLoading(){return this.renderBody()}renderFilterBar(){var e;const{location:t}=this.props,s=new Set((0,re.L)(t.query.team));return(0,V.BX)(ce,{children:[(0,V.tZ)(re.Z,{selectedTeams:s,handleChangeFilter:this.handleChangeFilter}),(0,V.tZ)(pe,{placeholder:(0,y.t)("Search by name"),query:null===(e=t.query)||void 0===e?void 0:e.name,onSearch:this.handleChangeSearch})]})}renderList(){const{params:{orgId:e},location:{query:t},organization:s,router:a}=this.props,{loading:r,ruleList:n=[],ruleListPageLinks:i}=this.state,l=new Set(o()(null==n?void 0:n.map((e=>{let{projects:t}=e;return t})))),d={asc:"1"===t.asc,field:t.sort||"date_added"},{cursor:u,page:m,...g}=t,x=d.field.includes("incident_status")||d.field.includes("date_triggered"),Z=(0,V.tZ)(v.CC,{color:"gray300",size:"xs",direction:d.asc?"up":"down"});return(0,V.tZ)(le,{children:(0,V.BX)(c.or,{fullWidth:!0,children:[this.renderFilterBar(),(0,V.tZ)(I.Z,{provideUserTeams:!0,children:t=>{let{initiallyLoaded:a,teams:i}=t;return(0,V.tZ)(ue,{headers:[(0,V.BX)(de,{role:"columnheader","aria-sort":"name"!==d.field?"none":d.asc?"ascending":"descending",to:{pathname:location.pathname,query:{...g,asc:"name"===d.field&&d.asc?void 0:"1",sort:"name"}},children:[(0,y.t)("Alert Rule")," ","name"===d.field&&Z]},"name"),(0,V.BX)(de,{role:"columnheader","aria-sort":x?d.asc?"ascending":"descending":"none",to:{pathname:location.pathname,query:{...g,asc:x&&!d.asc?"1":void 0,sort:["incident_status","date_triggered"]}},children:[(0,y.t)("Status")," ",x&&Z]},"status"),(0,y.t)("Project"),(0,y.t)("Team"),(0,V.BX)(de,{role:"columnheader","aria-sort":"date_added"!==d.field?"none":d.asc?"ascending":"descending",to:{pathname:location.pathname,query:{...g,asc:"date_added"!==d.field||d.asc?void 0:"1",sort:"date_added"}},children:[(0,y.t)("Created")," ","date_added"===d.field&&Z]},"dateAdded"),(0,y.t)("Actions")],isLoading:r||!a,isEmpty:0===(null==n?void 0:n.length),emptyMessage:(0,y.t)("No alert rules found for the current query."),emptyAction:(0,V.tZ)(me,{children:(0,y._N)("Learn more about [link:Alerts]",{link:(0,V.tZ)(p.Z,{href:"https://docs.sentry.io/product/alerts-notifications/metric-alerts/"})})}),children:(0,V.tZ)(b.Z,{orgId:e,slugs:Array.from(l),children:t=>{let{initiallyLoaded:a,projects:r}=t;return n.map((t=>(0,V.tZ)(ae,{projectsLoaded:a,projects:r,rule:t,orgId:e,onDelete:this.handleDeleteRule,organization:s,userTeams:new Set(i.map((e=>e.id)))},`${(0,A.Gm)(t)?"metric":"issue"}-${t.id}`)))}})})}}),(0,V.tZ)(h.Z,{pageLinks:i,onCursor:(e,t,s)=>{let r=g.team;r&&0!==r.length||(r=""),a.push({pathname:t,query:{...g,team:r,cursor:e}})}})]})})}renderBody(){const{params:e,organization:t,router:s}=this.props,{orgId:a}=e;return(0,V.tZ)(Z.Z,{title:(0,y.t)("Alerts"),orgSlug:a,children:(0,V.BX)(m.Z,{organization:t,showDateSelector:!1,showEnvironmentSelector:!1,children:[(0,V.tZ)(C.Z,{organization:t,router:s,activeTab:"rules"}),this.renderList()]})})}}class ie extends n.Component{componentDidMount(){this.trackView()}componentDidUpdate(e){var t,s;const{location:a}=this.props;(null===(t=e.location.query)||void 0===t?void 0:t.sort)!==(null===(s=a.query)||void 0===s?void 0:s.sort)&&this.trackView()}trackView(){const{organization:e,location:t}=this.props;(0,f.ec)({eventKey:"alert_rules.viewed",eventName:"Alert Rules: Viewed",organization_id:e.id,sort:Array.isArray(t.query.sort)?t.query.sort.join(","):t.query.sort})}render(){return(0,V.tZ)(ne,{...this.props})}}ie.displayName="AlertRulesListContainer";const oe=(0,q.Z)(ie),le=(0,r.Z)(c.uT,{target:"eddauwb5"})({name:"108qp7n",styles:"margin-bottom:-20px"}),de=(0,r.Z)(u.Z,{target:"eddauwb4"})({name:"1sbdiq8",styles:"color:inherit;:hover{color:inherit;}"}),ce=(0,r.Z)("div",{target:"eddauwb3"})("display:flex;margin-bottom:",(0,w.Z)(1.5),";"),pe=(0,r.Z)(x.Z,{target:"eddauwb2"})("flex-grow:1;margin-left:",(0,w.Z)(1.5),";"),ue=(0,r.Z)(g.KB,{target:"eddauwb1"})("position:static;overflow:auto;@media (min-width: ",(e=>e.theme.breakpoints[0]),"){overflow:initial;}grid-template-columns:4fr auto 140px 60px 110px auto;white-space:nowrap;font-size:",(e=>e.theme.fontSizeMedium),";"),me=(0,r.Z)("p",{target:"eddauwb0"})("font-size:",(e=>e.theme.fontSizeLarge),";")}}]);
//# sourceMappingURL=../sourcemaps/app_views_alerts_rules_index_tsx.b75a23a0e4492fa70d26de10c4ea2dad.js.map