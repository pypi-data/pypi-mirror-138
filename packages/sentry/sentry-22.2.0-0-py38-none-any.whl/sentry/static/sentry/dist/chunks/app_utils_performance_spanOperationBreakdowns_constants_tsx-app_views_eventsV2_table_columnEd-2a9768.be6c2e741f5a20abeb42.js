"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_utils_performance_spanOperationBreakdowns_constants_tsx-app_views_eventsV2_table_columnEd-2a9768"],{"./app/utils/performance/spanOperationBreakdowns/constants.tsx":(e,t,s)=>{s.d(t,{$:()=>n});const n=["spans.browser","spans.http","spans.db","spans.resource"]},"./app/utils/userselect.tsx":(e,t,s)=>{s.d(t,{l:()=>n});const n=e=>{const t={userSelect:document.body.style.userSelect,MozUserSelect:document.body.style.MozUserSelect,msUserSelect:document.body.style.msUserSelect,webkitUserSelect:document.body.style.webkitUserSelect};return document.body.style.userSelect=e.userSelect||"",document.body.style.MozUserSelect=e.MozUserSelect||"",document.body.style.msUserSelect=e.msUserSelect||"",document.body.style.webkitUserSelect=e.webkitUserSelect||"",t}},"./app/views/eventsV2/table/columnEditCollection.tsx":(e,t,s)=>{s.d(t,{Z:()=>M});var n=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),o=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),i=(s("../node_modules/core-js/modules/web.dom-collections.iterator.js"),s("../node_modules/react/index.js")),r=s("../node_modules/react-dom/profiling.js"),a=s("./app/components/arithmeticInput/parser.tsx"),d=s("./app/components/button.tsx"),l=s("./app/components/charts/styles.tsx"),c=s("./app/icons/index.tsx"),u=s("./app/locale.tsx"),p=s("./app/styles/space.tsx"),g=s("./app/utils/analytics.tsx"),h=s("./app/utils/discover/fields.tsx"),m=s("./app/utils/theme.tsx");function f(e,t){const s="nativeEvent"in e?e.nativeEvent:e;return window.TouchEvent&&s instanceof TouchEvent?s.targetTouches[0][t]:s instanceof MouseEvent?s[t]:0}var v=s("./app/utils/userselect.tsx"),b=s("./app/views/dashboardsV2/types.tsx"),y=s("./app/views/dashboardsV2/widgetBuilder/issueWidget/fields.tsx"),x=s("./app/views/eventsV2/table/queryField.tsx"),S=s("./app/views/eventsV2/table/types.tsx"),w=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const Z="draggable-item";var C;!function(e){e[e.TOP=0]="TOP",e[e.BOTTOM=1]="BOTTOM"}(C||(C={}));class E extends i.Component{constructor(){super(...arguments),(0,n.Z)(this,"state",{isDragging:!1,draggingIndex:void 0,draggingTargetIndex:void 0,draggingGrabbedOffset:void 0,error:new Map,left:void 0,top:void 0}),(0,n.Z)(this,"previousUserSelect",null),(0,n.Z)(this,"portal",null),(0,n.Z)(this,"dragGhostRef",i.createRef()),(0,n.Z)(this,"handleAddColumn",(()=>{this.props.onChange([...this.props.columns,{kind:"field",field:""}])})),(0,n.Z)(this,"handleAddEquation",(()=>{const{organization:e}=this.props,t={kind:S.L.EQUATION,field:""};(0,g.ec)({eventKey:"discover_v2.add_equation",eventName:"Discoverv2: Equation added",organization_id:parseInt(e.id,10)}),this.props.onChange([...this.props.columns,t])})),(0,n.Z)(this,"handleUpdateColumn",((e,t)=>{const s=[...this.props.columns];"equation"===t.kind?this.setState((s=>{const n=new Map(s.error);return n.set(e,(0,a.W9)(t.field).error),{...s,error:n}})):this.updateEquationFields(s,e,t),s.splice(e,1,t),this.props.onChange(s)})),(0,n.Z)(this,"updateEquationFields",((e,t,s)=>{const n=e[t],o=(0,h.sN)(e[t]),i=(0,h.sN)(s);if((0,h.el)(s)&&!(0,h.bv)(e,n))for(let t=0;t<e.length;t++){const s=e[t];if("equation"===s.kind){const r=(0,a.W9)(s.field);let d="",l=0;const c="function"===n.kind?r.tc.functions:r.tc.fields;for(const e of c)e.term===o&&l!==e.location.end.offset&&(d+=s.field.substring(l,e.location.start.offset)+i,l=e.location.end.offset);d+=s.field.substring(l),e[t]={kind:"equation",field:d}}}})),(0,n.Z)(this,"onDragMove",(e=>{var t,s;const{isDragging:n,draggingTargetIndex:o,draggingGrabbedOffset:i}=this.state;if(!n||!["mousemove","touchmove"].includes(e.type))return;e.preventDefault(),e.stopPropagation();const r=f(e,"pageX"),a=f(e,"pageY"),d=null!==(t=null==i?void 0:i.x)&&void 0!==t?t:0,l=null!==(s=null==i?void 0:i.y)&&void 0!==s?s:0;if(this.dragGhostRef.current){const e=this.dragGhostRef.current;e.style.left=r-d+"px",e.style.top=a-l+"px"}const c=document.querySelectorAll(`.${Z}`),u=Array.from(c).findIndex((e=>{const t=e.getBoundingClientRect(),s=a,n=window.scrollY+t.top,o=window.scrollY+t.top+t.height;return s>=n&&s<=o}));u>=0&&u!==o&&this.setState({draggingTargetIndex:u})})),(0,n.Z)(this,"isFixedIssueColumn",(e=>{const{source:t,columns:s}=this.props,n=s[e];return s.filter((e=>"field"===e.kind&&e.field===y.Sh.ISSUE)).length<=1&&t===b.l9.ISSUE&&"field"===n.kind&&n.field===y.Sh.ISSUE})),(0,n.Z)(this,"onDragEnd",(e=>{if(!this.state.isDragging||!["mouseup","touchend"].includes(e.type))return;const t=this.state.draggingIndex,s=this.state.draggingTargetIndex;if("number"!=typeof t||"number"!=typeof s)return;this.cleanUpListeners(),this.previousUserSelect&&((0,v.l)(this.previousUserSelect),this.previousUserSelect=null);const n=[...this.props.columns],o=n.splice(t,1);n.splice(s,0,o[0]),this.checkColumnErrors(n),this.props.onChange(n),this.setState({isDragging:!1,left:void 0,top:void 0,draggingIndex:void 0,draggingTargetIndex:void 0,draggingGrabbedOffset:void 0})}))}componentDidMount(){if(!this.portal){const e=document.createElement("div");e.style.position="absolute",e.style.top="0",e.style.left="0",e.style.zIndex=String(m.ZP.zIndex.modal),this.portal=e,document.body.appendChild(this.portal)}this.checkColumnErrors(this.props.columns)}componentWillUnmount(){this.portal&&document.body.removeChild(this.portal),this.cleanUpListeners()}checkColumnErrors(e){const t=new Map;for(let s=0;s<e.length;s+=1){const n=e[s];if("equation"===n.kind){const e=(0,a.W9)(n.field);e.error&&t.set(s,e.error)}}this.setState({error:t})}keyForColumn(e,t){return"function"===e.kind?[...e.function,t].join(":"):[...e.field,t].join(":")}cleanUpListeners(){this.state.isDragging&&(window.removeEventListener("mousemove",this.onDragMove),window.removeEventListener("touchmove",this.onDragMove),window.removeEventListener("mouseup",this.onDragEnd),window.removeEventListener("touchend",this.onDragEnd))}removeColumn(e){const t=[...this.props.columns];t.splice(e,1),this.checkColumnErrors(t),this.props.onChange(t)}startDrag(e,t){if(this.state.isDragging||!["mousedown","touchstart"].includes(e.type))return;e.preventDefault(),e.stopPropagation();const s=f(e,"pageY"),n=f(e,"pageX"),{x:o,y:i}=Array.from(document.querySelectorAll(`.${Z}`)).find((t=>t.contains(e.currentTarget))).getBoundingClientRect(),r={x:n-o+4,y:s-i+4};this.previousUserSelect=(0,v.l)({userSelect:"none",MozUserSelect:"none",msUserSelect:"none",webkitUserSelect:"none"}),window.addEventListener("mousemove",this.onDragMove),window.addEventListener("touchmove",this.onDragMove),window.addEventListener("mouseup",this.onDragEnd),window.addEventListener("touchend",this.onDragEnd),this.setState({isDragging:!0,draggingIndex:t,draggingTargetIndex:t,draggingGrabbedOffset:r,top:s,left:n})}renderGhost(e){var t,s;const{isDragging:n,draggingIndex:o,draggingGrabbedOffset:i}=this.state,a=o;if("number"!=typeof a||!n||!this.portal)return null;const d=null!==(t=null==i?void 0:i.x)&&void 0!==t?t:0,l=null!==(s=null==i?void 0:i.y)&&void 0!==s?s:0,c=Number(this.state.top)-l,u=Number(this.state.left)-d,p=this.props.columns[a],g={top:`${c}px`,left:`${u}px`},h=(0,w.tZ)(D,{ref:this.dragGhostRef,style:g,children:this.renderItem(p,a,{isGhost:!0,gridColumns:e})});return r.createPortal(h,this.portal)}renderItem(e,t,s){let{canDelete:n=!0,canDrag:o=!0,isGhost:r=!1,gridColumns:a=2,disabled:l=!1}=s;const{columns:p,fieldOptions:g,filterPrimaryOptions:h}=this.props,{isDragging:m,draggingTargetIndex:f,draggingIndex:v}=this.state;let b=null;if(m&&!1===r&&f===t&&(b=(0,w.tZ)(U,{className:Z},`placeholder:${this.keyForColumn(e,r)}`)),m&&!1===r&&v===t)return b;const y=Number(f)<=Number(v)?C.TOP:C.BOTTOM;return(0,w.BX)(i.Fragment,{children:[y===C.TOP&&b,(0,w.BX)(k,{className:r?"":Z,children:[o?(0,w.tZ)(d.ZP,{"aria-label":(0,u.t)("Drag to reorder"),onMouseDown:e=>this.startDrag(e,t),onTouchStart:e=>this.startDrag(e,t),icon:(0,w.tZ)(c.LS,{size:"xs"}),size:"zero",borderless:!0}):(0,w.tZ)("span",{}),(0,w.tZ)(x.q,{fieldOptions:g,gridColumns:a,fieldValue:e,onChange:e=>this.handleUpdateColumn(t,e),error:this.state.error.get(t),takeFocus:t===this.props.columns.length-1,otherColumns:p,shouldRenderTag:!0,disabled:l,filterPrimaryOptions:h}),n||"equation"===e.kind?(0,w.tZ)(d.ZP,{"data-test-id":`remove-column-${t}`,"aria-label":(0,u.t)("Remove column"),onClick:()=>this.removeColumn(t),icon:(0,w.tZ)(c.Fz,{}),borderless:!0}):(0,w.tZ)("span",{})]}),y===C.BOTTOM&&b]},`${t}:${this.keyForColumn(e,r)}`)}render(){const{className:e,columns:t,source:s}=this.props,n=t.filter((e=>"equation"!==e.kind)).length>1,o=t.length>1,i=t.length<20,r=i?void 0:"Sorry, you reached the maximum number of columns. Delete columns to add more.",a=s===b.l9.ISSUE?1:Math.max(...t.map((e=>"function"===e.kind&&2===h.lx[e.function[0]].parameters.length?3:2)));return(0,w.BX)("div",{className:e,children:[this.renderGhost(a),s!==b.l9.ISSUE&&(0,w.tZ)(k,{children:(0,w.BX)(T,{gridColumns:a,children:[(0,w.tZ)(O,{children:(0,u.t)("Tag / Field / Function")}),(0,w.tZ)(O,{children:(0,u.t)("Field Parameter")})]})}),t.map(((e,t)=>this.isFixedIssueColumn(t)?this.renderItem(e,t,{canDelete:!1,canDrag:o,gridColumns:a,disabled:!0}):this.renderItem(e,t,{canDelete:n,canDrag:o,gridColumns:a}))),(0,w.tZ)(k,{children:(0,w.BX)(I,{children:[(0,w.tZ)(d.ZP,{size:"small","aria-label":(0,u.t)("Add a Column"),onClick:this.handleAddColumn,title:r,disabled:!i,icon:(0,w.tZ)(c.N_,{isCircled:!0,size:"xs"}),children:(0,u.t)("Add a Column")}),s!==b.l9.ISSUE&&s!==b.l9.METRICS&&(0,w.tZ)(d.ZP,{size:"small","aria-label":(0,u.t)("Add an Equation"),onClick:this.handleAddEquation,title:r,disabled:!i,icon:(0,w.tZ)(c.N_,{isCircled:!0,size:"xs"}),children:(0,u.t)("Add an Equation")})]})})]})}}E.displayName="ColumnEditCollection";const k=(0,o.Z)("div",{target:"ev0fm795"})("display:grid;grid-template-columns:",(0,p.Z)(3)," 1fr ",(0,p.Z)(3),";justify-content:center;align-items:center;width:100%;touch-action:none;padding-bottom:",(0,p.Z)(1),";"),D=(0,o.Z)("div",{target:"ev0fm794"})("background:",(e=>e.theme.background),";display:block;position:absolute;padding:",4,"px;border-radius:",(e=>e.theme.borderRadius),";box-shadow:0 0 15px rgba(0, 0, 0, 0.15);width:710px;opacity:0.8;cursor:grabbing;padding-right:",(0,p.Z)(2),";&>",k,"{padding-bottom:0;}& svg{cursor:grabbing;}"),U=(0,o.Z)("div",{target:"ev0fm793"})("margin:0 ",(0,p.Z)(3)," ",(0,p.Z)(1)," ",(0,p.Z)(3),";border:2px dashed ",(e=>e.theme.border),";border-radius:",(e=>e.theme.borderRadius),";height:41px;"),I=(0,o.Z)("div",{target:"ev0fm792"})("grid-column:2/3;& button{margin-right:",(0,p.Z)(1),";}"),T=(0,o.Z)("div",{target:"ev0fm791"})("grid-column:2/3;display:grid;grid-template-columns:repeat(",(e=>e.gridColumns),", 1fr);grid-column-gap:",(0,p.Z)(1),";"),O=(0,o.Z)(l.OT,{target:"ev0fm790"})({name:"ti75j2",styles:"margin:0"}),M=E}}]);
//# sourceMappingURL=../sourcemaps/app_utils_performance_spanOperationBreakdowns_constants_tsx-app_views_eventsV2_table_columnEd-2a9768.8e869c3b9fd48280dc36b7f9edad05d0.js.map