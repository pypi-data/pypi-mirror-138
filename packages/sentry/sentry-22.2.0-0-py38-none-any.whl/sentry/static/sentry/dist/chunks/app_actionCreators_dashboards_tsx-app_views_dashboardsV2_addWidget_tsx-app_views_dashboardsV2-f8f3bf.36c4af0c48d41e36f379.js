"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_actionCreators_dashboards_tsx-app_views_dashboardsV2_addWidget_tsx-app_views_dashboardsV2-f8f3bf"],{"./app/actionCreators/dashboards.tsx":(e,t,i)=>{i.d(t,{JR:()=>a,a_:()=>d,AK:()=>l,Y:()=>u,iM:()=>c,QL:()=>p});var s=i("../node_modules/lodash/omit.js"),r=i.n(s),n=i("./app/actionCreators/indicator.tsx"),o=i("./app/locale.tsx");function a(e,t,i,s){const{title:a,widgets:d}=i,l=e.requestPromise(`/organizations/${t}/dashboards/`,{method:"POST",data:{title:a,widgets:d.map((e=>r()(e,["tempId"]))),duplicate:s}});return l.catch((e=>{var t;const i=null!==(t=null==e?void 0:e.responseJSON)&&void 0!==t?t:null;i?(0,n.Iw)(i):(0,n.Iw)((0,o.t)("Unable to create dashboard"))})),l}function d(e,t,i){return e.requestPromise(`/organizations/${t}/dashboards/${i}/visit/`,{method:"POST"})}function l(e,t,i){const s=e.requestPromise(`/organizations/${t}/dashboards/${i}/`,{method:"GET"});return s.catch((e=>{var t;const i=null!==(t=null==e?void 0:e.responseJSON)&&void 0!==t?t:null;i?(0,n.Iw)(i):(0,n.Iw)((0,o.t)("Unable to load dashboard"))})),s}function u(e,t,i){const s={title:i.title,widgets:i.widgets.map((e=>r()(e,["tempId"])))},a=e.requestPromise(`/organizations/${t}/dashboards/${i.id}/`,{method:"PUT",data:s});return a.catch((e=>{var t;const i=null!==(t=null==e?void 0:e.responseJSON)&&void 0!==t?t:null;i?(0,n.Iw)(i):(0,n.Iw)((0,o.t)("Unable to update dashboard"))})),a}function c(e,t,i){const s=e.requestPromise(`/organizations/${t}/dashboards/${i}/`,{method:"DELETE"});return s.catch((e=>{var t;const i=null!==(t=null==e?void 0:e.responseJSON)&&void 0!==t?t:null;i?(0,n.Iw)(i):(0,n.Iw)((0,o.t)("Unable to delete dashboard"))})),s}function p(e,t,i){return e.requestPromise(`/organizations/${t}/dashboards/widgets/`,{method:"POST",data:i})}},"./app/utils/discover/charts.tsx":(e,t,i)=>{i.d(t,{CX:()=>a,gu:()=>d});var s=i("./app/locale.tsx"),r=i("./app/utils.tsx"),n=i("./app/utils/discover/fields.tsx"),o=i("./app/utils/formatters.tsx");function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(!(0,r.ri)(e))return"—";switch((0,n.Px)(t)){case"integer":case"number":return e.toLocaleString();case"percentage":return(0,o.rl)(e,2);case"duration":return(0,o.g9)(e/1e3,2,!0);default:return e.toString()}}function d(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];switch((0,n.Px)(t)){case"integer":case"number":return i?(0,o.Du)(e):e.toLocaleString();case"percentage":return(0,o.rl)(e,0);case"duration":return l(e);default:return e.toString()}}function l(e){if(0===e)return"0";if(e>=o.ps){const t=(e/o.ps).toFixed(0);return(0,s.t)("%swk",t)}if(e>=o.x4){const t=(e/o.x4).toFixed(0);return(0,s.t)("%sd",t)}if(e>=o.kr){const t=(e/o.kr).toFixed(0);return(0,s.t)("%shr",t)}if(e>=o.EB){const t=(e/o.EB).toFixed(0);return(0,s.t)("%smin",t)}if(e>=o.sh){const t=(e/o.sh).toFixed(0);return(0,s.t)("%ss",t)}const t=e.toFixed(0);return(0,s.t)("%sms",t)}},"./app/views/dashboardsV2/addWidget.tsx":(e,t,i)=>{i.d(t,{g:()=>c,Z:()=>h});var s=i("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),r=i("../node_modules/@dnd-kit/sortable/dist/sortable.esm.js"),n=i("./app/components/button.tsx"),o=i("./app/icons/index.tsx"),a=i("./app/locale.tsx"),d=i("./app/views/dashboardsV2/types.tsx"),l=i("./app/views/dashboardsV2/widgetWrapper.tsx"),u=i("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const c="add-widget-button",p={x:0,y:0,scaleX:1,scaleY:1};function g(e){let{onAddWidget:t,onOpenWidgetBuilder:i,orgFeatures:s}=e;const n=s.includes("new-widget-builder-experience")?i:t,{setNodeRef:g,transform:h}=(0,r.nB)({disabled:!0,id:c,transition:null});return(0,u.tZ)(l.Z,{ref:g,displayType:d.FO.BIG_NUMBER,layoutId:c,style:{originX:0,originY:0},animate:h?{x:h.x,y:h.y,scaleX:null!=h&&h.scaleX&&h.scaleX<=1?h.scaleX:1,scaleY:null!=h&&h.scaleY&&h.scaleY<=1?h.scaleY:1}:p,transition:{duration:.25},children:(0,u.tZ)(y,{onClick:n,children:(0,u.tZ)(m,{"data-test-id":"widget-add",icon:(0,u.tZ)(o.N_,{size:"lg",isCircled:!0,color:"inactive"}),"aria-label":(0,a.t)("Add widget")})})},"add")}g.displayName="AddWidget";const h=g,m=(0,s.Z)(n.ZP,{target:"e1sxcph31"})({name:"6ayxgl",styles:"border:none;&,&:focus,&:active,&:hover{background:transparent;box-shadow:none;}"}),y=(0,s.Z)("div",{target:"e1sxcph30"})("width:100%;height:110px;border:2px dashed ",(e=>e.theme.border),";border-radius:",(e=>e.theme.borderRadius),";display:flex;align-items:center;justify-content:center;cursor:",(e=>e.onClick?"pointer":""),";")},"./app/views/dashboardsV2/layoutUtils.tsx":(e,t,i)=>{i.d(t,{c6:()=>h,$n:()=>y,Yb:()=>b,TE:()=>v,VW:()=>f,RI:()=>w,hq:()=>Z,I_:()=>x,WJ:()=>R,Sp:()=>_,Hh:()=>C,_F:()=>T,W8:()=>M,Bb:()=>z}),i("../node_modules/core-js/modules/web.dom-collections.iterator.js");var s=i("../node_modules/react-grid-layout/build/utils.js"),r=i("../node_modules/lodash/pickBy.js"),n=i.n(r),o=i("../node_modules/lodash/sortBy.js"),a=i.n(o),d=i("../node_modules/lodash/zip.js"),l=i.n(d),u=i("./app/utils.tsx"),c=i("./app/utils/guid.tsx"),p=i("./app/views/dashboardsV2/dashboard.tsx"),g=i("./app/views/dashboardsV2/types.tsx");const h=2,m=["x","y","w","h","minW","maxW","minH","maxH"];function y(e,t){return e.id?`${e.id}-index-${t}`:`index-${t}`}function b(e){var t;return`grid-item-${null!==(t=e.id)&&void 0!==t?t:e.tempId}`}function v(e){var t;return(null!==(t=e.id)&&void 0!==t?t:e.tempId)?e:{...e,tempId:(0,c.E)()}}function f(e,t){if(0===e.length)return[];const i=l()(e,t);return a()(i,["0.y","0.x"]).map(((e,t)=>{let[i,s]=e;return{...i,x:0,y:2*t,w:2,h:s.displayType===g.FO.BIG_NUMBER?1:2}}))}function w(e){return e.filter((e=>(0,u.ri)(e.layout))).map((e=>{let{layout:t,...i}=e;return{...t,i:b(i)}}))}function Z(e){return n()(e,((e,t)=>(0,u.ri)(e)&&m.includes(t)))}function x(e){return e===g.FO.BIG_NUMBER?1:2}function R(){return Array(p.ey).fill(0)}function _(e){const t=R();return e.forEach((e=>{let{x:i,w:s,y:r,h:n}=e;for(let e=i;e<i+s;e++)t[e]=Math.max(r+n,t[e])})),t}function C(e,t){const i=[...e],s=Math.max(...i);for(let e=0;e<=s;e++)for(let s=0;s<=i.length-h;s++){if(i[s]>e)continue;const r=s+h;if(i.slice(s,r).every((t=>t<=e))){for(let r=s;r<s+h;r++)i[r]=e+t;return[{x:s,y:e},[...i]]}}for(let e=0;e<h;e++)i[e]=s;return[{x:0,y:s},[...i]]}function T(e,t){let i=[...t];return e.map((e=>{if((0,u.ri)(e.layout))return e;const t=x(e.displayType),[s,r]=C(i,t);return i=r,{...e,layout:{...s,h:t,minH:t,w:h}}}))}function M(e){var t;const{displayType:i,layout:s}=e,r={...e};if(!(0,u.ri)(s))return r;const n=x(i),o={...s,h:Math.max(null!==(t=null==s?void 0:s.h)&&void 0!==t?t:n,n),minH:n};return{...r,layout:o}}function z(e){const t=(0,s.compact)(w(e),"vertical",p.ey);return e.map((e=>{const i=t.find((t=>{let{i}=t;return i===b(e)}));return i?{...e,layout:i}:e}))}},"./app/views/dashboardsV2/sortableWidget.tsx":(e,t,i)=>{i.d(t,{Z:()=>p});var s=i("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),r=i("../node_modules/react/index.js"),n=i("../node_modules/@dnd-kit/sortable/dist/sortable.esm.js"),o=i("./app/utils/theme.tsx"),a=i("./app/utils/withOrganization.tsx"),d=i("./app/views/dashboardsV2/widgetCard/index.tsx"),l=i("./app/views/dashboardsV2/widgetWrapper.tsx"),u=i("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function c(e){const{organization:t,widget:i,dragId:s,isEditing:a,widgetLimitReached:c,onDelete:p,onEdit:h,onDuplicate:m,isPreview:y,isMobile:b,windowWidth:v}=e,{attributes:f,listeners:w,setNodeRef:Z,transform:x,isDragging:R,isSorting:_}=(0,n.nB)({id:s,transition:null});(0,r.useEffect)((()=>{if(R)return document.body.style.cursor="grabbing",function(){document.body.style.cursor=""}}),[R]);let C={widget:i,isEditing:a,widgetLimitReached:c,onDelete:p,onEdit:h,onDuplicate:m,isSorting:_,hideToolbar:_,currentWidgetDragging:R,showContextMenu:!0,isPreview:y};return t.features.includes("dashboard-grid-layout")?(C={...C,isMobile:b,windowWidth:v,isSorting:!1,currentWidgetDragging:!1,tableItemLimit:20},(0,u.tZ)(g,{children:(0,u.tZ)(d.Z,{...C})})):(C={...C,draggableProps:{attributes:f,listeners:w}},(0,u.tZ)(l.Z,{ref:Z,displayType:i.displayType,layoutId:s,style:{originX:R?1:0,originY:0,boxShadow:R?o.ZP.dropShadowHeavy:"none",borderRadius:R?o.ZP.borderRadius:void 0},animate:x?{x:x.x,y:x.y,scaleX:null!=x&&x.scaleX&&x.scaleX<=1?x.scaleX:1,scaleY:null!=x&&x.scaleY&&x.scaleY<=1?x.scaleY:1,zIndex:R?o.ZP.zIndex.modal:"auto"}:{zIndex:"auto"},transformTemplate:(e,t)=>a&&x?t:"none",transition:{duration:R?0:.25,easings:{type:"spring"}},children:(0,u.tZ)(d.Z,{...C})}))}c.displayName="SortableWidget";const p=(0,a.Z)(c),g=(0,s.Z)("div",{target:"e12vujy00"})({name:"13udsys",styles:"height:100%"})},"./app/views/dashboardsV2/utils.tsx":(e,t,i)=>{i.d(t,{qk:()=>b,tT:()=>v,y1:()=>w,DW:()=>Z,s:()=>x}),i("../node_modules/core-js/modules/web.dom-collections.iterator.js");var s=i("../node_modules/lodash/cloneDeep.js"),r=i.n(s),n=i("../node_modules/lodash/pick.js"),o=i.n(n),a=i("./images/dashboard/widget-area.svg"),d=i("./images/dashboard/widget-bar.svg"),l=i("./images/dashboard/widget-big-number.svg"),u=i("./images/dashboard/widget-line-1.svg"),c=i("./images/dashboard/widget-table.svg"),p=i("./images/dashboard/widget-world-map.svg"),g=i("./app/components/charts/utils.tsx"),h=i("./app/utils/dates.tsx"),m=i("./app/utils/discover/eventView.tsx"),y=i("./app/views/dashboardsV2/types.tsx");function b(e){return r()(e)}function v(e,t,i,s){const{start:r,end:n,period:o}=i.datetime,{projects:a,environments:d}=i,l=s!==y.FO.WORLD_MAP||t.fields.includes("geo.country_code")?t.fields:["geo.country_code",...t.fields],u=s!==y.FO.WORLD_MAP||t.conditions.includes("has:geo.country_code")?t.conditions:`${t.conditions} has:geo.country_code`.trim();return m.ZP.fromSavedQuery({id:void 0,name:e,version:2,fields:l,query:u,orderby:t.orderby,projects:a,range:null!=o?o:void 0,start:r?(0,h.v5)(r):void 0,end:n?(0,h.v5)(n):void 0,environment:d})}function f(e){return"string"==typeof e?[e]:e}function w(e){if(e){const t=f(e.queryNames),i=f(e.queryConditions),s=f(e.queryFields),r=[];if(i&&t&&s&&"string"==typeof e.queryOrderby&&i.forEach(((i,n)=>{r.push({name:t[n],conditions:i,fields:s,orderby:e.queryOrderby})})),e.title&&e.displayType&&e.interval&&r.length>0)return{...o()(e,["title","displayType","interval"]),widgetType:y.l9.DISCOVER,queries:r}}}function Z(e){switch(e){case y.FO.BAR:return d;case y.FO.AREA:case y.FO.TOP_N:return a;case y.FO.BIG_NUMBER:return l;case y.FO.TABLE:return c;case y.FO.WORLD_MAP:return p;case y.FO.LINE:default:return u}}function x(e,t){let i="bar"===e.displayType?"1d":e.interval;i||(i="5m");const s=(0,h.YJ)(i);if((0,g.Nm)(t)/(60*s)>66){const e=(0,g.ZS)(t,"high");if(s<(0,h.YJ)(e))return e}return i}},"./app/views/dashboardsV2/widgetBuilder/utils.tsx":(e,t,i)=>{i.d(t,{FO:()=>r,qg:()=>n,hV:()=>o});var s=i("./app/locale.tsx");let r,n;!function(e){e.AREA="area",e.BAR="bar",e.LINE="line",e.TABLE="table",e.WORLD_MAP="world_map",e.BIG_NUMBER="big_number",e.STACKED_AREA="stacked_area",e.TOP_N="top_n"}(r||(r={})),function(e){e.EVENTS="events",e.ISSUES="issues",e.METRICS="metrics"}(n||(n={}));const o={[r.AREA]:(0,s.t)("Area Chart"),[r.BAR]:(0,s.t)("Bar Chart"),[r.LINE]:(0,s.t)("Line Chart"),[r.TABLE]:(0,s.t)("Table"),[r.WORLD_MAP]:(0,s.t)("World Map"),[r.BIG_NUMBER]:(0,s.t)("Big Number"),[r.TOP_N]:(0,s.t)("Top 5 Events")}},"./app/views/dashboardsV2/widgetCard/index.tsx":(e,t,i)=>{i.d(t,{Z:()=>ut});var s=i("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),r=i("../node_modules/react/index.js"),n=i("../node_modules/react-lazyload/lib/index.js"),o=i("../node_modules/react-router/es/index.js"),a=i("./app/components/charts/styles.tsx"),d=i("./app/components/errorBoundary.tsx"),l=i("./app/components/panels/index.tsx"),u=i("./app/components/placeholder.tsx"),c=i("./app/components/tooltip.tsx"),p=i("./app/icons/index.tsx"),g=i("./app/locale.tsx"),h=i("./app/styles/overflowEllipsis.tsx"),m=i("./app/styles/space.tsx"),y=i("./app/utils/withApi.tsx"),b=i("./app/utils/withOrganization.tsx"),v=i("./app/utils/withPageFilters.tsx"),f=i("./app/views/dashboardsV2/dashboard.tsx"),w=i("./app/components/charts/errorPanel.tsx"),Z=i("./app/components/panels/panelTable.tsx"),x=i("./app/components/truncate.tsx"),R=i("./app/utils/discover/fieldRenderers.tsx"),_=i("./app/utils/discover/fields.tsx"),C=i("./app/views/eventsV2/utils.tsx"),T=i("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class M extends r.Component{renderRow(e,t,i,s){const{location:r,organization:n,getCustomFieldRenderer:o}=this.props;return s.map((s=>{var a;const d=(null!==(a=null==o?void 0:o(s.key,i))&&void 0!==a?a:(0,R.Js)(s.key,i))(t,{organization:n,location:r});return(0,T.tZ)(F,{children:d},`${e}:${s.name}`)}))}render(){const{className:e,loading:t,fields:i,metadata:s,data:n,title:o,fieldHeaderMap:a,stickyHeaders:d}=this.props,l=null!=s?s:{},u=(0,C.Hg)(i.map((e=>({field:e}))));return(0,T.BX)(r.Fragment,{children:[o&&(0,T.tZ)("h4",{children:o}),(0,T.tZ)(E,{className:e,isLoading:t,headers:u.map(((e,t)=>{var i;const s=(0,_.qG)(e.name,e.type,l),r=null!==(i=null==a?void 0:a[e.key])&&void 0!==i?i:e.name;return(0,T.tZ)(S,{align:s,children:(0,T.tZ)(c.Z,{title:r,children:(0,T.tZ)(z,{value:r,maxLength:30,expandable:!1})})},t)})),isEmpty:!(null!=n&&n.length),stickyHeaders:d,disablePadding:!0,children:null==n?void 0:n.map(((e,t)=>this.renderRow(t,e,l,u)))})]})}}M.displayName="SimpleTableChart";const z=(0,s.Z)(x.Z,{target:"e3tr8vk3"})({name:"1bmnxg7",styles:"white-space:nowrap"}),E=(0,s.Z)(Z.Z,{target:"e3tr8vk2"})("border-radius:0;border-left:0;border-right:0;border-bottom:0;margin:0;",Z.z,"{height:min-content;}"),S=(0,s.Z)("div",{target:"e3tr8vk1"})((e=>e.align?`text-align: ${e.align};`:"")," padding:",(0,m.Z)(1)," ",(0,m.Z)(3),";"),F=(0,s.Z)("div",{target:"e3tr8vk0"})("padding:",(0,m.Z)(1)," ",(0,m.Z)(3),";"),I=(0,b.Z)(M);var j=i("./app/components/charts/transparentLoadingMask.tsx"),q=i("./app/components/loadingIndicator.tsx"),D=i("./app/components/assigneeSelector.tsx"),O=i("./app/components/count.tsx"),k=i("./app/components/links/link.tsx"),W=i("./app/components/organizations/timeRangeSelector/utils.tsx"),B=i("./app/constants/index.tsx"),A=i("./app/stores/memberListStore.tsx"),N=i("./app/utils/discover/eventView.tsx"),L=i("./app/utils/discover/styles.tsx");const P={issue:{sortField:null,renderFunc:(e,t)=>{let{organization:i}=t;const s=e["issue.id"];if(!s)return(0,T.tZ)(L.W2,{children:(0,T.tZ)(L.PV,{shortId:`${e.issue}`})});const r={pathname:`/organizations/${i.slug}/issues/${s}/`};return(0,T.tZ)(L.W2,{children:(0,T.tZ)(L.Jo,{to:r,"aria-label":s,children:(0,T.tZ)(L.PV,{shortId:`${e.issue}`})})})}},assignee:{sortField:"assignee.name",renderFunc:e=>{const t=A.Z.getAll();return(0,T.tZ)(Q,{children:(0,T.tZ)(D.Z,{id:e.id,memberList:t,noDropdown:!0})})}},lifetimeEvents:{sortField:null,renderFunc:(e,t)=>{let{organization:i}=t;return $(e,i,"lifetimeEvents")}},lifetimeUsers:{sortField:null,renderFunc:(e,t)=>{let{organization:i}=t;return $(e,i,"lifetimeUsers")}},events:{sortField:null,renderFunc:(e,t)=>{let{organization:i}=t;return $(e,i,"events")}},users:{sortField:null,renderFunc:(e,t)=>{let{organization:i}=t;return $(e,i,"users")}},lifetimeCount:{sortField:null,renderFunc:(e,t)=>{let{organization:i}=t;return $(e,i,"lifetimeEvents")}},lifetimeUserCount:{sortField:null,renderFunc:(e,t)=>{let{organization:i}=t;return $(e,i,"lifetimeUsers")}},count:{sortField:null,renderFunc:(e,t)=>{let{organization:i}=t;return $(e,i,"events")}},userCount:{sortField:null,renderFunc:(e,t)=>{let{organization:i}=t;return $(e,i,"users")}}},$=(e,t,i)=>{const{start:s,end:n,period:o}=e,a=!!/user/i.exec(i.toLowerCase()),d=e[i],l=e[a?"users":"events"],u=e[a?"lifetimeUsers":"lifetimeEvents"],p=e[a?"filteredUsers":"filteredEvents"],h=U(e,t),m=U(e,t,!0),y=s&&n?"time range":(0,W.T)(o||B.GY).toLowerCase();return(0,T.tZ)(L.W2,{children:(0,T.tZ)(c.Z,{isHoverable:!0,skipWrapper:!0,popperStyle:{padding:0},title:(0,T.BX)("div",{children:[p?(0,T.BX)(r.Fragment,{children:[(0,T.BX)(H,{to:m,children:[(0,g.t)("Matching search filters"),(0,T.tZ)(G,{value:p})]}),(0,T.tZ)(J,{})]}):null,(0,T.BX)(H,{to:h,children:[(0,g.t)(`Total in ${y}`),(0,T.tZ)(G,{value:l})]}),(0,T.tZ)(J,{}),(0,T.BX)(X,{children:[(0,g.t)("Since issue began"),(0,T.tZ)(G,{value:u})]})]}),children:(0,T.tZ)("span",{children:["events","users"].includes(i)&&p?(0,T.BX)(r.Fragment,{children:[(0,T.tZ)(O.Z,{value:p}),(0,T.tZ)(Y,{value:d})]}):(0,T.tZ)(O.Z,{value:d})})})})};$.displayName="issuesCountRenderer";const U=(e,t,i)=>{const s={projects:[Number(e.projectId)]};return N.ZP.fromSavedQuery({...s,id:void 0,start:e.start,end:e.end,range:e.period,name:e.title,fields:["title","release","environment","user","timestamp"],orderby:"-timestamp",query:`issue.id:${e.id}${i?e.discoverSearchQuery:""}`,version:2}).getResultsViewUrlTarget(t.slug)},V={name:"s5gdgx",styles:"width:100%;justify-content:space-between;display:flex;padding:6px 10px"},X=(0,s.Z)("div",{target:"e1va53iy5"})(V,";"),H=(0,s.Z)(k.Z,{target:"e1va53iy4"})(V,";color:",(e=>e.theme.gray400),";&:hover{color:",(e=>e.theme.gray400),";background:",(e=>e.theme.hover),";}"),Y=(0,s.Z)(O.Z,{target:"e1va53iy3"})(":before{content:'/';padding-left:",(0,m.Z)(.25),";padding-right:2px;}"),G=(0,s.Z)((e=>{let{value:t,...i}=e;return(0,T.tZ)("div",{...i,children:(0,T.tZ)(O.Z,{value:t})})}),{target:"e1va53iy2"})("text-align:right;font-weight:bold;font-variant-numeric:tabular-nums;padding-left:",(0,m.Z)(2),";color:",(e=>e.theme.subText),";"),J=(0,s.Z)("div",{target:"e1va53iy1"})("height:1px;overflow:hidden;background-color:",(e=>e.theme.innerBorder),";"),Q=(0,s.Z)("div",{target:"e1va53iy0"})({name:"1h3u8pb",styles:"display:flex;justify-content:left;margin-left:18px;:hover{cursor:default;}"});function K(e){return P.hasOwnProperty(e)?P[e].renderFunc:null}var ee=i("./app/views/dashboardsV2/types.tsx"),te=i("./app/views/dashboardsV2/widgetBuilder/issueWidget/fields.tsx"),ie=i("../node_modules/@emotion/react/dist/emotion-element-a8309070.browser.esm.js"),se=i("../node_modules/lodash/isEqual.js"),re=i.n(se),ne=i("../node_modules/lodash/omit.js"),oe=i.n(ne),ae=i("./app/components/charts/areaChart.tsx"),de=i("./app/components/charts/barChart.tsx"),le=i("./app/components/charts/chartZoom.tsx"),ue=i("./app/components/charts/lineChart.tsx"),ce=i("./app/components/charts/transitionChart.tsx"),pe=i("./app/components/charts/utils.tsx"),ge=i("./app/components/charts/worldMapChart.tsx"),he=i("./app/utils.tsx"),me=i("./app/utils/discover/charts.tsx"),ye=i("./app/utils/getDynamicText.tsx");class be extends r.Component{shouldComponentUpdate(e){if(this.props.widget.displayType===ee.FO.BIG_NUMBER&&e.widget.displayType===ee.FO.BIG_NUMBER&&this.props.windowWidth!==e.windowWidth)return!0;const t={...oe()(this.props,["windowWidth"]),widget:{...this.props.widget,title:""}};return e={...oe()(e,["windowWidth"]),widget:{...e.widget,title:""}},!re()(t,e)}tableResultComponent(e){let{loading:t,errorMessage:i,tableResults:s}=e;const{location:r,widget:n,organization:o}=this.props;return i?(0,T.tZ)(w.Z,{children:(0,T.tZ)(p.FC,{color:"gray500",size:"lg"})}):void 0===s||t?(0,T.tZ)(we,{height:"200px"}):s.map(((e,i)=>{var a,d;const l=null!==(a=null===(d=n.queries[i])||void 0===d?void 0:d.fields)&&void 0!==a?a:[];return(0,T.tZ)(Re,{location:r,fields:l,title:s.length>1?e.title:"",loading:t,metadata:e.meta,data:e.data,organization:o,stickyHeaders:!0},`table:${e.title}`)}))}bigNumberComponent(e){let{loading:t,errorMessage:i,tableResults:s}=e;if(i)return(0,T.tZ)(w.Z,{children:(0,T.tZ)(p.FC,{color:"gray500",size:"lg"})});if(void 0===s||t)return(0,T.tZ)(Ze,{children:"—"});const{organization:r,widget:n,isMobile:o,windowWidth:a}=this.props;return s.map((e=>{var t,i,s,d,l,u,p;const g=null!==(t=e.meta)&&void 0!==t?t:{},h=Object.keys(null!=g?g:{})[0];if(!h||!e.data.length)return(0,T.tZ)(Ze,{children:"—"},`big_number:${e.title}`);const m=e.data[0],y=(0,R.fK)(h,g)(m),b=!(n.id||n.tempId);if(!r.features.includes("dashboard-grid-layout")||b||o||!(0,he.ri)(a))return(0,T.tZ)(Ze,{children:y},`big_number:${e.title}`);const v=null!==(i=n.layout)&&void 0!==i&&i.w&&null!==(s=n.layout)&&void 0!==s&&s.h?n.layout.w/n.layout.h**1.5:1,f=null!==(d=n.layout)&&void 0!==d&&d.w&&null!==(l=n.layout)&&void 0!==l&&l.h?n.layout.w/n.layout.h:1,w=null!==(u=n.layout)&&void 0!==u&&u.w&&null!==(p=n.layout)&&void 0!==p&&p.h?v*(300+a/4):400,Z=v<.5?200*f:200;return(0,T.tZ)(Ze,{fontSize:Z,children:(0,T.tZ)("svg",{width:"100%",height:"100%",viewBox:`0 0 ${w} 200`,preserveAspectRatio:"xMinYMin meet",children:(0,T.tZ)("foreignObject",{x:"0",y:"0",width:"100%",height:"100%",children:(0,T.tZ)(c.Z,{title:y,showOnlyOnOverflow:!0,children:y})})})},`big_number:${e.title}`)}))}chartComponent(e){const{widget:t}=this.props;switch(t.displayType){case"bar":return(0,T.tZ)(de.Z,{...e});case"area":case"top_n":return(0,T.tZ)(ae.Z,{stacked:!0,...e});case"world_map":return(0,T.tZ)(ge.Z,{...e});case"line":default:return(0,T.tZ)(ue.Z,{...e})}}render(){var e,t,i;const{theme:s,tableResults:r,timeseriesResults:n,errorMessage:o,loading:a,widget:d,organization:l}=this.props;if("table"===d.displayType)return(0,T.BX)(ce.Z,{loading:a,reloading:a,children:[(0,T.tZ)(fe,{loading:a}),this.tableResultComponent({tableResults:r,loading:a,errorMessage:o})]});if("big_number"===d.displayType)return(0,T.BX)(ce.Z,{loading:a,reloading:a,children:[(0,T.tZ)(fe,{loading:a}),this.bigNumberComponent({tableResults:r,loading:a,errorMessage:o})]});if(o)return(0,T.tZ)(w.Z,{children:(0,T.tZ)(p.FC,{color:"gray500",size:"lg"})});const{location:c,router:g,selection:h}=this.props,{start:m,end:y,period:b,utc:v}=h.datetime,f=Boolean(l.features.includes("dashboard-grid-layout")&&(d.id||d.tempId));if("world_map"===d.displayType){const{data:e,title:t}=(0,pe.JT)(r),i=[{seriesName:t,data:e}];return(0,T.BX)(ce.Z,{loading:a,reloading:a,children:[(0,T.tZ)(fe,{loading:a}),(0,T.tZ)(xe,{autoHeightResize:f,children:(0,ye.Z)({value:this.chartComponent({series:i,autoHeightResize:f}),fixed:(0,T.tZ)(u.Z,{height:"200px",testId:"skeleton-ui"})})})]})}const Z={left:0,top:0,selected:(0,pe.RI)(c),formatter:e=>{const t=(0,_.hW)(e);if(null!==t){const i=(0,_.b8)(t);null!==i&&(e=i.toUpperCase())}return(0,_.by)(e)&&(e=(0,_.bQ)(e)),e}},x=null!==(e=null===(t=d.queries[0])||void 0===t||null===(i=t.fields)||void 0===i?void 0:i[0])&&void 0!==e?e:"count()",R=(0,_.GO)(x)?(0,_.vp)(x):x,C={autoHeightResize:f,grid:{left:4,right:0,top:"40px",bottom:0},seriesOptions:{showSymbol:!1},tooltip:{trigger:"axis",valueFormatter:me.CX},yAxis:{axisLabel:{color:s.chartLabel,formatter:e=>(0,me.gu)(e,R)}}};return(0,T.tZ)(le.Z,{router:g,period:b,start:m,end:y,utc:v,children:e=>{if(o)return(0,T.tZ)(w.Z,{children:(0,T.tZ)(p.FC,{color:"gray500",size:"lg"})});const t=n?s.charts.getColorPalette(n.length-2):[];"top_n"===d.displayType&&n&&n.length>5&&(t[t.length-1]=s.chartOther);const i=n?n.map(((e,i)=>{let s="";return void 0!==e.seriesName&&(s=(0,_.GO)(e.seriesName)?(0,_.vp)(e.seriesName):e.seriesName),{...e,seriesName:s,color:t[i]}})):[];return(0,T.BX)(ce.Z,{loading:a,reloading:a,children:[(0,T.tZ)(fe,{loading:a}),(0,T.tZ)(xe,{autoHeightResize:f,children:(0,ye.Z)({value:this.chartComponent({...e,...C,legend:Z,series:i}),fixed:(0,T.tZ)(u.Z,{height:"200px",testId:"skeleton-ui"})})})]})}})}}be.displayName="WidgetCardChart";const ve=(0,s.Z)((e=>(0,T.tZ)(j.Z,{...e,maskBackgroundColor:"transparent"})),{target:"eb7j3e4"})({name:"1vcob1d",styles:"display:flex;justify-content:center;align-items:center"}),fe=e=>{let{loading:t}=e;return t?(0,T.tZ)(ve,{visible:t,children:(0,T.tZ)(q.Z,{mini:!0})}):null};fe.displayName="LoadingScreen";const we=(0,s.Z)(u.Z,{target:"eb7j3e3"})("background-color:",(e=>e.theme.surface200),";"),Ze=(0,s.Z)("div",{target:"eb7j3e2"})("resize:both;line-height:1;display:inline-flex;flex:1;width:100%;min-height:0;font-size:",(e=>e.fontSize?`${e.fontSize}px`:"32px"),";color:",(e=>e.theme.headingColor),";padding:",(0,m.Z)(1)," ",(0,m.Z)(3)," ",(0,m.Z)(3)," ",(0,m.Z)(3),";*{text-align:left!important;}"),xe=(0,s.Z)("div",{target:"eb7j3e1"})((e=>e.autoHeightResize&&"height: 100%;")," padding:0 ",(0,m.Z)(3)," ",(0,m.Z)(3),";"),Re=(0,s.Z)(I,{target:"eb7j3e0"})("margin-top:",(0,m.Z)(1.5),";border-bottom-left-radius:",(e=>e.theme.borderRadius),";border-bottom-right-radius:",(e=>e.theme.borderRadius),";font-size:",(e=>e.theme.fontSizeMedium),";box-shadow:none;"),_e=(0,ie.b)(be);var Ce=i("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),Te=(i("../node_modules/core-js/modules/web.dom-collections.iterator.js"),i("../node_modules/query-string/index.js")),Me=i("./app/components/organizations/pageFilters/utils.tsx"),ze=i("./app/stores/groupStore.tsx"),Ee=i("./app/utils/dates.tsx"),Se=i("./app/utils/stream.tsx"),Fe=i("./app/views/issueList/utils.tsx");const Ie=Fe.qh.DATE,je=Fe.io.EVENTS,qe=["owners"];class De extends r.Component{constructor(){super(...arguments),(0,Ce.Z)(this,"state",{loading:!0,errorMessage:void 0,tableResults:[],memberListStoreLoaded:A.Z.isLoaded(),totalCount:null}),(0,Ce.Z)(this,"unlisteners",[A.Z.listen((()=>{this.setState({memberListStoreLoaded:A.Z.isLoaded()})}),void 0)])}componentDidMount(){this.fetchData()}componentDidUpdate(e){const{selection:t,widget:i}=this.props,[s]=e.widget.queries.reduce(((e,t)=>{let[i,s]=e,{name:r,...n}=t;return i.push(n),s.push(r),[i,s]}),[[],[]]),[r]=i.queries.reduce(((e,t)=>{let[i,s]=e,{name:r,...n}=t;return i.push(n),s.push(r),[i,s]}),[[],[]]);re()(i.displayType,e.widget.displayType)&&re()(i.interval,e.widget.interval)&&re()(r,s)&&re()(i.displayType,e.widget.displayType)&&(0,Me.WO)(t,e.selection)||this.fetchData()}componentWillUnmount(){this.unlisteners.forEach((e=>null==e?void 0:e()))}transformTableResults(){const{selection:e,widget:t}=this.props,{tableResults:i}=this.state;ze.Z.add(i);const s=[];return i.forEach((i=>{let{id:r,shortId:n,title:o,lifetime:a,filtered:d,count:l,userCount:u,project:c,...p}=i;const g={};Object.keys(p).filter((e=>["number","string"].includes(typeof p[e]))).forEach((e=>{g[e]=p[e]}));const h={...g,events:l,users:u,id:r,"issue.id":r,issue:n,title:o,project:c.slug};a&&(h.lifetimeEvents=null==a?void 0:a.count,h.lifetimeUsers=null==a?void 0:a.userCount),d&&(h.filteredEvents=null==d?void 0:d.count,h.filteredUsers=null==d?void 0:d.userCount);const m=t.queries[0].conditions,y=[];if("string"==typeof m){const e=(0,Se.w)(m);for(const t in e)if(!Fe.QL.includes(t)){const i=e[t].includes(" ")?`"${e[t]}"`:e[t];y.push(`${t}:${i}`)}e.__text&&y.push(e.__text)}h.discoverSearchQuery=(y.length?" ":"")+y.join(" "),h.projectId=c.id;const{period:b,start:v,end:f}=e.datetime||{};v&&f&&(h.start=(0,Ee.v5)(v),h.end=(0,Ee.v5)(f)),h.period=null!=b?b:"",s.push(h)})),s}async fetchIssuesData(){const{selection:e,api:t,organization:i,widget:s,limit:r}=this.props;this.setState({tableResults:[]});const n=s.queries[0],o=`/organizations/${i.slug}/issues/`,a={project:e.projects,environment:e.environments,query:n.conditions,sort:n.orderby||Ie,display:je,expand:qe};e.datetime.period&&(a.statsPeriod=e.datetime.period),e.datetime.end&&(a.end=(0,Ee.v5)(e.datetime.end)),e.datetime.start&&(a.start=(0,Ee.v5)(e.datetime.start)),e.datetime.utc&&(a.utc=e.datetime.utc);try{var d;const[e,i,s]=await t.requestPromise(o,{includeAllArgs:!0,method:"GET",data:Te.stringify({...a,limit:null!=r?r:5})});this.setState({loading:!1,errorMessage:void 0,tableResults:e,totalCount:null!==(d=null==s?void 0:s.getResponseHeader("X-Hits"))&&void 0!==d?d:null})}catch(e){var l,u;const t=null!==(l=null==e||null===(u=e.responseJSON)||void 0===u?void 0:u.detail)&&void 0!==l?l:null;this.setState({loading:!1,errorMessage:null!=t?t:(0,g.t)("Unable to load Widget"),tableResults:[]})}}fetchData(){this.setState({loading:!0,errorMessage:void 0}),this.fetchIssuesData()}render(){const{children:e}=this.props,{loading:t,errorMessage:i,memberListStoreLoaded:s}=this.state,r=this.transformTableResults();return(0,ye.Z)({value:e({loading:t||!s,transformedResults:r,errorMessage:i}),fixed:(0,T.tZ)("div",{})})}}De.displayName="IssueWidgetQueries";const Oe=De;class ke extends r.Component{render(){return null}}ke.displayName="MetricsWidgetQueries";const We=ke;var Be=i("../node_modules/lodash/cloneDeep.js"),Ae=i.n(Be),Ne=i("./app/actionCreators/events.tsx"),Le=i("./app/utils/discover/genericDiscoverQuery.tsx"),Pe=i("./app/utils/discover/types.tsx"),$e=i("./app/views/dashboardsV2/utils.tsx");function Ue(e,t){var i;return{seriesName:t,data:null!==(i=null==e?void 0:e.data.map((e=>{let[t,i]=e;return{name:1e3*t,value:i.reduce(((e,t)=>{let{count:i}=t;return e+i}),0)}})))&&void 0!==i?i:[]}}function Ve(e,t){let i=[];const s=e.name;if((0,pe.Xe)(t)){const e=Object.keys(t).map((e=>{const i=s?`${s} : ${e}`:e,r=t[e];return[r.order||0,Ue(r,i)]})).sort(((e,t)=>e[0]-t[0])).map((e=>e[1]));i=i.concat(e)}else{const r=e.fields[0],n=Ue(t,s?`${s} : ${r}`:r);i.push(n)}return i}class Xe extends r.Component{constructor(){super(...arguments),(0,Ce.Z)(this,"state",{loading:!0,queryFetchID:void 0,errorMessage:void 0,timeseriesResults:void 0,rawResults:void 0,tableResults:void 0}),(0,Ce.Z)(this,"_isMounted",!1)}componentDidMount(){this._isMounted=!0,this.fetchData()}componentDidUpdate(e){var t;const{selection:i,widget:s}=this.props,[r,n]=e.widget.queries.map((e=>(e.fields=e.fields.filter((e=>!!e)),e))).reduce(((e,t)=>{let[i,s]=e,{name:r,...n}=t;return i.push(r),s.push(n),[i,s]}),[[],[]]),[o,a]=s.queries.map((e=>(e.fields=e.fields.filter((e=>!!e&&"equation|"!==e)),e))).reduce(((e,t)=>{let[i,s]=e,{name:r,...n}=t;return i.push(r),s.push(n),[i,s]}),[[],[]]);re()(s.displayType,e.widget.displayType)&&re()(s.interval,e.widget.interval)&&re()(a,n)&&re()(s.displayType,e.widget.displayType)&&(0,Me.WO)(i,e.selection)?this.state.loading||re()(r,o)||(null===(t=this.state.rawResults)||void 0===t?void 0:t.length)!==s.queries.length||this.setState((e=>{const t=s.queries.reduce(((t,i,s)=>t.concat(Ve(i,e.rawResults[s]))),[]);return{...e,timeseriesResults:t}})):this.fetchData()}componentWillUnmount(){this._isMounted=!1}fetchEventData(e){const{selection:t,api:i,organization:s,widget:r,limit:n}=this.props;let o=[];this.setState({tableResults:[]});const a=r.queries.map((e=>{const o=(0,$e.tT)(r.title,e,t);let a="";const d={per_page:null!=n?n:5,noPagination:!0};if("table"===r.displayType)a=`/organizations/${s.slug}/eventsv2/`,d.referrer="api.dashboards.tablewidget";else if("big_number"===r.displayType)a=`/organizations/${s.slug}/eventsv2/`,d.per_page=1,d.referrer="api.dashboards.bignumberwidget";else{if("world_map"!==r.displayType)throw Error("Expected widget displayType to be either big_number, table or world_map");a=`/organizations/${s.slug}/events-geo/`,delete d.per_page,d.referrer="api.dashboards.worldmapwidget"}return(0,Le.AA)(i,a,{...o.generateQueryStringObject(),...d})}));let d=0;a.forEach((async(t,i)=>{try{var s,n;const[l]=await t,u=l;if(u.title=null!==(s=null===(n=r.queries[i])||void 0===n?void 0:n.name)&&void 0!==s?s:"",o=[...o,u],!this._isMounted)return;this.setState((t=>t.queryFetchID!==e?t:{...t,tableResults:o}))}catch(e){var l;const t=(null==e||null===(l=e.responseJSON)||void 0===l?void 0:l.detail)||(0,g.t)("An unknown error occurred.");this.setState({errorMessage:t})}finally{if(d++,!this._isMounted)return;this.setState((t=>t.queryFetchID!==e?t:{...t,loading:d!==a.length}))}}))}fetchTimeseriesData(e,t){const{selection:i,api:s,organization:r,widget:n}=this.props;this.setState({timeseriesResults:[],rawResults:[]});const{environments:o,projects:a}=i,{start:d,end:l,period:u}=i.datetime,c=(0,$e.s)(n,{start:d,end:l,period:u}),p=n.queries.map((e=>{let i;return"top_n"===n.displayType?(i={organization:r,interval:c,start:d,end:l,project:a,environment:o,period:u,query:e.conditions,yAxis:(0,_.Nk)(e.fields)[0],includePrevious:!1,referrer:`api.dashboards.widget.${t}-chart`,partial:!0,topEvents:Pe.hY,field:e.fields},e.orderby&&(i.orderby=e.orderby)):i={organization:r,interval:c,start:d,end:l,project:a,environment:o,period:u,query:e.conditions,yAxis:e.fields,orderby:e.orderby,includePrevious:!1,referrer:`api.dashboards.widget.${t}-chart`,partial:!0},(0,Ne.lI)(s,i)}));let h=0;p.forEach((async(t,i)=>{try{const s=await t;if(!this._isMounted)return;this.setState((t=>{var r,o;if(t.queryFetchID!==e)return t;const a=[...null!==(r=t.timeseriesResults)&&void 0!==r?r:[]],d=Ve(n.queries[i],s);d.forEach(((e,t)=>{a[i*d.length+t]=e}));const l=Ae()(null!==(o=t.rawResults)&&void 0!==o?o:[]);return l[i]=s,{...t,timeseriesResults:a,rawResults:l}}))}catch(e){var s;const t=(null==e||null===(s=e.responseJSON)||void 0===s?void 0:s.detail)||(0,g.t)("An unknown error occurred.");this.setState({errorMessage:t})}finally{if(h++,!this._isMounted)return;this.setState((t=>t.queryFetchID!==e?t:{...t,loading:h!==p.length}))}}))}fetchData(){const{widget:e}=this.props,t=Symbol("queryFetchID");this.setState({loading:!0,errorMessage:void 0,queryFetchID:t}),["table","world_map","big_number"].includes(e.displayType)?this.fetchEventData(t):this.fetchTimeseriesData(t,e.displayType)}render(){const{children:e}=this.props,{loading:t,timeseriesResults:i,tableResults:s,errorMessage:r}=this.state;return e({loading:t,timeseriesResults:null==i?void 0:i.filter((e=>!!e)),tableResults:s,errorMessage:r})}}Xe.displayName="WidgetQueries";const He=Xe,Ye=(0,o.withRouter)((function(e){let{location:t,router:i,api:s,organization:n,selection:o,widget:a,isMobile:d,renderErrorMessage:l,tableItemLimit:u,windowWidth:c}=e;function g(e){let{loading:i,errorMessage:s,transformedResults:r}=e;return s?(0,T.tZ)(w.Z,{children:(0,T.tZ)(p.FC,{color:"gray500",size:"lg"})}):i?(0,T.tZ)(Qe,{height:"200px"}):(0,T.tZ)(Ke,{location:t,title:"",fields:a.queries[0].fields,loading:i,metadata:te.$L,data:r,organization:n,getCustomFieldRenderer:K,fieldHeaderMap:te.kh,stickyHeaders:!0})}return a.widgetType===ee.l9.ISSUE?(0,T.tZ)(Oe,{api:s,organization:n,widget:a,selection:o,limit:u,children:e=>{let{transformedResults:t,errorMessage:i,loading:s}=e;return(0,T.BX)(r.Fragment,{children:["function"==typeof l?l(i):null,(0,T.tZ)(Je,{loading:s}),g({transformedResults:t,loading:s,errorMessage:i})]})}}):a.widgetType===ee.l9.METRICS?(0,T.tZ)(We,{api:s,organization:n,widget:a,selection:o,limit:u,children:e=>{let{tableResults:s,timeseriesResults:u,errorMessage:p,loading:g}=e;return(0,T.BX)(r.Fragment,{children:["function"==typeof l?l(p):null,(0,T.tZ)(_e,{timeseriesResults:u,tableResults:s,errorMessage:p,loading:g,location:t,widget:a,selection:o,router:i,organization:n,isMobile:d,windowWidth:c})]})}}):(0,T.tZ)(He,{api:s,organization:n,widget:a,selection:o,limit:u,children:e=>{let{tableResults:s,timeseriesResults:u,errorMessage:p,loading:g}=e;return(0,T.BX)(r.Fragment,{children:["function"==typeof l?l(p):null,(0,T.tZ)(_e,{timeseriesResults:u,tableResults:s,errorMessage:p,loading:g,location:t,widget:a,selection:o,router:i,organization:n,isMobile:d,windowWidth:c})]})}})})),Ge=(0,s.Z)((e=>(0,T.tZ)(j.Z,{...e,maskBackgroundColor:"transparent"})),{target:"e14ay5ol2"})({name:"1vcob1d",styles:"display:flex;justify-content:center;align-items:center"}),Je=e=>{let{loading:t}=e;return t?(0,T.tZ)(Ge,{visible:t,children:(0,T.tZ)(q.Z,{mini:!0})}):null};Je.displayName="LoadingScreen";const Qe=(0,s.Z)(u.Z,{target:"e14ay5ol1"})("background-color:",(e=>e.theme.surface200),";"),Ke=(0,s.Z)(I,{target:"e14ay5ol0"})("margin-top:",(0,m.Z)(1.5),";border-bottom-left-radius:",(e=>e.theme.borderRadius),";border-bottom-right-radius:",(e=>e.theme.borderRadius),";font-size:",(e=>e.theme.fontSizeMedium),";box-shadow:none;");var et=i("./app/actionCreators/modal.tsx"),tt=i("./app/components/arithmeticInput/parser.tsx"),it=i("./app/components/confirm.tsx"),st=i("./app/components/dropdownMenuControlV2.tsx"),rt=i("./app/utils/analytics/trackAdvancedAnalyticsEvent.tsx"),nt=i("./app/views/dashboardsV2/widgetBuilder/utils.tsx");function ot(e){let{organization:t,selection:i,widget:s,widgetLimitReached:r,onDelete:n,onDuplicate:o,onEdit:a,showContextMenu:d,isPreview:l}=e;if(!d)return null;const u=[],c=[];if(l)return(0,T.tZ)(dt,{children:(0,T.tZ)(st.Z,{items:[{key:"preview",label:(0,g.t)("This is a preview only. To edit, you must add this dashboard.")}],triggerProps:{"aria-label":(0,g.t)("Widget actions"),size:"xsmall",borderless:!0,showChevron:!1,icon:(0,T.tZ)(p.YR,{direction:"down",size:"sm"})},placement:"bottom right",disabledKeys:["preview"]})});if(t.features.includes("discover-basic")&&s.widgetType===ee.l9.DISCOVER&&s.queries.length){const e=(0,$e.tT)(s.title,s.queries[0],i,s.displayType),r=e.getResultsViewUrlTarget(t.slug),n=e.getYAxisOptions().map((e=>{let{value:t}=e;return t}));switch(r.query.yAxis=[...new Set(s.queries[0].fields.filter((e=>n.includes(e))))].slice(0,3),s.displayType){case nt.FO.WORLD_MAP:r.query.display=Pe.DC.WORLDMAP;break;case nt.FO.BAR:r.query.display=Pe.DC.BAR;break;case nt.FO.TOP_N:r.query.display=Pe.DC.TOP5,r.query.yAxis=s.queries[0].fields[s.queries[0].fields.length-1],r.query.field=s.queries[0].fields.slice(0,-1)}const o=new Set;s.queries[0].fields.forEach((e=>{if((0,_.GO)(e)){const t=(0,tt.W9)((0,_.bQ)(e)).tc;t.fields.forEach((e=>{let{term:t}=e;return o.add(t)})),t.functions.forEach((e=>{let{term:t}=e;return o.add(t)}))}})),o.forEach((e=>{const t=r.query.field;Array.isArray(t)&&!t.includes(e)&&t.unshift(e)}));const a=`${r.pathname}?${Te.stringify({...r.query})}`;u.push({key:"open-in-discover",label:(0,g.t)("Open in Discover"),leadingItems:(0,T.tZ)(p.a6,{}),to:1===s.queries.length?a:void 0,onAction:()=>{1!==s.queries.length?((0,rt.Z)("dashboards_views.query_selector.opened",{organization:t,widget_type:s.displayType}),(0,et.openDashboardWidgetQuerySelectorModal)({organization:t,widget:s})):(0,rt.Z)("dashboards_views.open_in_discover.opened",{organization:t,widget_type:s.displayType})}})}if(s.widgetType===ee.l9.ISSUE){var h,m,y,b;const{start:e,end:r,utc:n,period:o}=i.datetime,a=e&&r?{start:(0,Ee.v5)(e),end:(0,Ee.v5)(r),utc:n}:{statsPeriod:o},d=`/organizations/${t.slug}/issues/?${Te.stringify({query:null===(h=s.queries)||void 0===h||null===(m=h[0])||void 0===m?void 0:m.conditions,sort:null===(y=s.queries)||void 0===y||null===(b=y[0])||void 0===b?void 0:b.orderby,...a})}`;u.push({key:"open-in-issues",label:(0,g.t)("Open in Issues"),leadingItems:(0,T.tZ)(p.XI,{}),to:d})}return t.features.includes("dashboards-edit")&&(u.push({key:"duplicate-widget",label:(0,g.t)("Duplicate Widget"),leadingItems:(0,T.tZ)(p.vU,{}),onAction:()=>null==o?void 0:o()}),r&&c.push("duplicate-widget"),u.push({key:"edit-widget",label:(0,g.t)("Edit Widget"),leadingItems:(0,T.tZ)(p.yl,{}),onAction:()=>null==a?void 0:a()}),u.push({key:"delete-widget",label:(0,g.t)("Delete Widget"),leadingItems:(0,T.tZ)(p.Fz,{}),priority:"danger",onAction:()=>{(0,it._)({message:(0,g.t)("Are you sure you want to delete this widget?"),priority:"danger",onConfirm:()=>null==n?void 0:n()})}})),u.length?(0,T.tZ)(dt,{children:(0,T.tZ)(st.Z,{items:u,triggerProps:{"aria-label":(0,g.t)("Widget actions"),size:"xsmall",borderless:!0,showChevron:!1,icon:(0,T.tZ)(p.YR,{direction:"down",size:"sm"})},placement:"bottom right",disabledKeys:c})}):null}ot.displayName="WidgetCardContextMenu";const at=ot,dt=(0,s.Z)("div",{target:"e1yltioa0"})("display:flex;align-items:center;height:",(0,m.Z)(3),";margin-left:",(0,m.Z)(1),";");class lt extends r.Component{renderToolbar(){const{onEdit:e,onDelete:t,onDuplicate:i,draggableProps:s,hideToolbar:r,isEditing:n,isMobile:o}=this.props;return n?(0,T.tZ)(gt,{children:(0,T.BX)(ht,{style:{visibility:r?"hidden":"visible"},children:[!o&&(0,T.tZ)(mt,{children:(0,T.tZ)(yt,{color:"textColor",className:f.re,...null==s?void 0:s.listeners,...null==s?void 0:s.attributes})}),(0,T.tZ)(mt,{"data-test-id":"widget-edit",onClick:e,children:(0,T.tZ)(p.yl,{color:"textColor"})}),(0,T.tZ)(mt,{"aria-label":(0,g.t)("Duplicate Widget"),onClick:i,children:(0,T.tZ)(p.vU,{color:"textColor"})}),(0,T.tZ)(mt,{"data-test-id":"widget-delete",onClick:t,children:(0,T.tZ)(p.Fz,{color:"textColor"})})]})}):null}renderContextMenu(){const{widget:e,selection:t,organization:i,showContextMenu:s,isPreview:r,widgetLimitReached:n,onEdit:o,onDuplicate:a,onDelete:d,isEditing:l}=this.props;return l?null:(0,T.tZ)(at,{organization:i,widget:e,selection:t,showContextMenu:s,isPreview:r,widgetLimitReached:n,onDuplicate:a,onEdit:o,onDelete:d})}render(){const{api:e,organization:t,selection:i,widget:s,isMobile:r,renderErrorMessage:o,tableItemLimit:a,windowWidth:l,noLazyLoad:u}=this.props;return(0,T.tZ)(d.Z,{customComponent:(0,T.tZ)(ct,{children:(0,g.t)("Error loading widget data")}),children:(0,T.BX)(pt,{isDragging:!1,children:[(0,T.BX)(vt,{children:[(0,T.tZ)(c.Z,{title:s.title,containerDisplayMode:"grid",showOnlyOnOverflow:!0,children:(0,T.tZ)(bt,{children:s.title})}),this.renderContextMenu()]}),u?(0,T.tZ)(Ye,{api:e,organization:t,selection:i,widget:s,isMobile:r,renderErrorMessage:o,tableItemLimit:a,windowWidth:l}):(0,T.tZ)(n.ZP,{once:!0,resize:!0,height:200,children:(0,T.tZ)(Ye,{api:e,organization:t,selection:i,widget:s,isMobile:r,renderErrorMessage:o,tableItemLimit:a,windowWidth:l})}),this.renderToolbar()]})})}}lt.displayName="WidgetCard";const ut=(0,y.Z)((0,b.Z)((0,v.Z)((0,o.withRouter)(lt)))),ct=(0,s.Z)(u.Z,{target:"e1fl0u6g7"})("display:flex;align-items:center;justify-content:center;background-color:",(e=>e.theme.alert.error.backgroundLight),";border:1px solid ",(e=>e.theme.alert.error.border),";color:",(e=>e.theme.alert.error.textLight),";border-radius:",(e=>e.theme.borderRadius),";margin-bottom:",(0,m.Z)(2),";"),pt=(0,s.Z)(l.s_,{shouldForwardProp:e=>"isDragging"!==e,target:"e1fl0u6g6"})("margin:0;visibility:",(e=>e.isDragging?"hidden":"visible"),";height:100%;min-height:96px;display:flex;flex-direction:column;"),gt=(0,s.Z)("div",{target:"e1fl0u6g5"})("position:absolute;top:0;left:0;z-index:2;width:100%;height:100%;display:flex;justify-content:flex-end;align-items:flex-start;background-color:",(e=>e.theme.overlayBackgroundAlpha),";border-radius:",(e=>e.theme.borderRadius),";"),ht=(0,s.Z)("div",{target:"e1fl0u6g4"})("display:flex;margin:10px ",(0,m.Z)(2),";touch-action:none;"),mt=(0,s.Z)("div",{target:"e1fl0u6g3"})("padding:",(0,m.Z)(1),";&:hover{cursor:pointer;}"),yt=(0,s.Z)(p.LS,{target:"e1fl0u6g2"})({name:"1fhyj3b",styles:"&:hover{cursor:grab;}"}),bt=(0,s.Z)(a.Gh,{target:"e1fl0u6g1"})(h.Z,";font-weight:normal;"),vt=(0,s.Z)("div",{target:"e1fl0u6g0"})("padding:",(0,m.Z)(2)," ",(0,m.Z)(3)," 0 ",(0,m.Z)(3),";width:100%;display:flex;justify-content:space-between;")},"./app/views/dashboardsV2/widgetWrapper.tsx":(e,t,i)=>{i.d(t,{Z:()=>n});var s=i("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),r=i("../node_modules/framer-motion/dist/es/render/dom/motion.js");const n=(0,s.Z)(r.E.div,{target:"ec3gecx0"})("position:relative;touch-action:manipulation;",(e=>{switch(e.displayType){case"big_number":return`\n          /* 2 cols */\n          grid-area: span 1 / span 2;\n\n          @media (min-width: ${e.theme.breakpoints[0]}) {\n            /* 4 cols */\n            grid-area: span 1 / span 1;\n          }\n\n          @media (min-width: ${e.theme.breakpoints[3]}) {\n            /* 6 and 8 cols */\n            grid-area: span 1 / span 2;\n          }\n        `;default:return"\n          /* 2, 4, 6 and 8 cols */\n          grid-area: span 2 / span 2;\n        "}}),";")}}]);
//# sourceMappingURL=../sourcemaps/app_actionCreators_dashboards_tsx-app_views_dashboardsV2_addWidget_tsx-app_views_dashboardsV2-f8f3bf.e9f109f1293a66f66da760a863c786c6.js.map