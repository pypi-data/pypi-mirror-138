(this["webpackJsonporemda-client"]=this["webpackJsonporemda-client"]||[]).push([[0],{284:function(e,t,n){},285:function(e,t,n){},520:function(e,t,n){"use strict";n.r(t);var r,a,i,o=n(0),s=n.n(o),c=n(51),u=n.n(c),d=(n(284),n(285),n(97)),l=function(){return Object(d.b)()},p=d.c,f=n(124),b=n(29),j=Object(b.c)(),O=j.getInitialState(),h=Object(b.d)({name:"displays",initialState:O,reducers:{setDisplay:function(e,t){var n=t.payload;j.setOne(e,n)}},extraReducers:function(e){}}),v=j.getSelectors((function(e){return e.displays})),g=h.actions.setDisplay,y=h.reducer;function m(e){return e.type===r.Display}function x(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8;return"string"===typeof e?e.slice(-t):e}!function(e){e.Operator="operator",e.Display="display"}(r||(r={})),function(e){e.OneD="1D",e.TwoD="2D",e.ThreeD="3D"}(a||(a={})),function(e){e.Data="data",e.Display="display",e.Binary="binary"}(i||(i={}));var k,w,P=n(27),D=n(28),I=n(32),T=n.n(I),S=n(52),N=function(e){k=e},L=n(554),E=function(){function e(){Object(P.a)(this,e),this.listeners=void 0,this.listeners=new Map}return Object(D.a)(e,[{key:"decodeFromBlob",value:function(){var e=Object(S.a)(T.a.mark((function e(t){return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(L.a)(t.stream());case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"handleEvent",value:function(e){var t=this;e.type;this.decodeFromBlob(e.data).then((function(e){if("@@OREMDA"===e.type){var n=e.action,r=t.listeners.get(n);void 0!==r&&r.forEach((function(t){t(e)}))}}))}},{key:"addNotificationEventListener",value:function(e,t){var n=this.listeners.get(e);void 0===n?this.listeners.set(e,new Set([t])):n.add(t)}},{key:"removeNotificationEventListener",value:function(e,t){var n=this.listeners.get(e);void 0!==n&&n.delete(t)}}]),e}(),C=function(){function e(t){Object(P.a)(this,e),this.ws=void 0,this.listener=void 0,this.ws=t,this.listener=new E,this.ws.addEventListener("message",this.listener)}return Object(D.a)(e,[{key:"addNotificationEventListener",value:function(e,t){this.listener.addNotificationEventListener(e,t)}},{key:"removeNotificationEventListener",value:function(e,t){this.listener.removeNotificationEventListener(e,t)}}]),e}(),R=function(){return void 0===w&&void 0!==k&&(w=new C(k)),w},M=n(1),B=function(){function e(t){Object(P.a)(this,e),this.container=void 0,this.container=t}return Object(D.a)(e,[{key:"render",value:function(e){this.container.current&&(this.container.current.src=e)}}]),e}(),U=function(e){var t=Object(o.useRef)(null),n=Object(o.useRef)(new B(t)),r=R();Object(o.useEffect)((function(){if(void 0!==r){var t=function(t){if(n.current&&t.payload.displayId===e.display.id){var r=new Blob([t.payload.imageSrc],{type:"image/png"}),a=URL.createObjectURL(r);n.current.render(a)}};return r.addNotificationEventListener("DISPLAY_RENDER",t),function(){return r.removeNotificationEventListener("message",t)}}}),[r]);return Object(M.jsx)("img",{style:{objectFit:"contain",width:"100%",top:"50%",left:"50%",position:"absolute",transform:"translate(-50%,-50%)",maxHeight:"100%"},ref:t})},A=[{n:1,rows:1,cols:1},{n:2,rows:1,cols:2},{n:4,rows:2,cols:2},{n:6,rows:2,cols:3},{n:9,rows:3,cols:3},{n:12,rows:3,cols:4},{n:16,rows:4,cols:4}];var _=function(){var e=p(v.selectAll),t=function(e){var t,n=Object(f.a)(A);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(r.n>=e)return r}}catch(o){n.e(o)}finally{n.f()}var a=Math.floor(Math.sqrt(e));a=a*a<e?a+1:a;var i=Math.floor(e/a);return{n:(i=a*i<e?i+1:i)*a,rows:i,cols:a}}(e.length),n=t.rows,r=t.cols;return Object(M.jsx)("div",{className:"displays-panel",children:e.map((function(e,t){var i=t%r,o=Math.floor(t/r),s="".concat(100*i/r,"%"),c="".concat(100*o/n,"%"),u="".concat(100/r,"%"),d="".concat(100/n,"%");return Object(M.jsxs)("div",{className:"display-container",style:{left:s,top:c,width:u,height:d},children:[e.type===a.OneD&&Object(M.jsx)(U,{display:e}),e.type===a.TwoD&&Object(M.jsx)(U,{display:e}),Object(M.jsx)("span",{className:"display-label",children:"".concat(x(e.id)," - (").concat(e.type,")")})]},e.id)}))})},F=n(13),z=n(15),W=n(556),q=n(80),H=n(55),J=n(54),G=function(){function e(){Object(P.a)(this,e),this.token=void 0,this.baseUrl=""}return Object(D.a)(e,[{key:"getToken",value:function(){return this.token}},{key:"setToken",value:function(e){this.token=e}},{key:"getBaseURL",value:function(){return this.baseUrl}},{key:"setBaseURL",value:function(e){this.baseUrl=e}},{key:"get",value:function(e){return this.request(Object(z.a)(Object(z.a)({},e),{},{method:"GET"}))}},{key:"post",value:function(e){return this.request(Object(z.a)(Object(z.a)({},e),{},{method:"POST"}))}},{key:"put",value:function(e){return this.request(Object(z.a)(Object(z.a)({},e),{},{method:"PUT"}))}},{key:"patch",value:function(e){return this.request(Object(z.a)(Object(z.a)({},e),{},{method:"PATCH"}))}},{key:"delete",value:function(e){return this.request(Object(z.a)(Object(z.a)({},e),{},{method:"DELETE"}))}},{key:"ws",value:function(e){var t=this;return new Promise((function(n,r){try{var a=e.url,i=e.params;void 0===i&&(i={});var o=t.getBaseURL().replace("http","ws"),s=t.getToken();void 0!==s&&(i.token=s);var c="".concat(o,"/").concat(a,"?").concat(new URLSearchParams(i).toString()),u=new WebSocket(c);u.onopen=function(e){return n(u)},u.onerror=function(e){return r(e)}}catch(d){r(d)}}))}},{key:"request",value:function(e){return this.rawRequest(e)}},{key:"rawRequest",value:function(e){var t=e.url,n=e.method,r=e.headers,a=e.params,i=e.json,o=e.form,s=e.extra,c=e.abortSignal;void 0===n&&(n="GET"),void 0===r&&(r={}),void 0===a&&(a={}),void 0===s&&(s={});var u=this.getBaseURL(),d=this.getToken();d&&(r=Object(z.a)(Object(z.a)({},r),{},{Authorization:"bearer ".concat(d)}));var l=void 0;i?(r["Content-Type"]||(r=Object(z.a)(Object(z.a)({},r),{},{"Content-Type":"application/json"})),"application/json"===r["Content-Type"]&&(l=JSON.stringify(i))):o&&(l=o);var p="".concat(u,"/").concat(t,"?").concat(new URLSearchParams(a).toString()),f=Object(z.a)(Object(z.a)({},s),{},{method:n,headers:r,body:l,signal:c});return new Promise((function(e,t){fetch(p,f).then((function(n){n.status>=200&&n.status<300?e(n):t(n)})).catch(t)}))}}]),e}(),K=Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_API_URL||"".concat(window.location.origin,"/api/v1"),V=new G;function Y(e,t){var n={sessionId:e};return V.post({url:"pipelines",params:n,json:t}).then((function(e){return e.json()})).then((function(e){return e.graph}))}V.setBaseURL(K);var $,Q,X,Z,ee,te,ne,re,ae,ie,oe,se,ce,ue,de,le=Object(b.c)(),pe=le.getInitialState({status:{}}),fe=(Object(b.b)("pipelines/run",function(){var e=Object(S.a)(T.a.mark((function e(t,n){var r,a;return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.sessionId,a=t.pipeline,e.next=3,Y(r,a);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),Object(b.d)({name:"pipelines",initialState:pe,reducers:{setPipeline:function(e,t){var n=t.payload;le.setOne(e,n),e.status[n.id]="idle"},addEdge:function(e,t){var n=t.payload,r=n.pipelineId,a=n.edge,i=le.getSelectors().selectById(e,r);i&&(i=Object(q.a)(i,(function(e){e.edges=e.edges.filter((function(e){return e.id!==a.id})),e.edges.push(a)})),le.setOne(e,i))},removeEdge:function(e,t){var n=t.payload,r=n.pipelineId,a=n.edgeId,i=le.getSelectors().selectById(e,r);i&&(i=Object(q.a)(i,(function(e){e.edges=e.edges.filter((function(e){return e.id!==a}))})),le.setOne(e,i))}},extraReducers:function(e){}})),be=le.getSelectors((function(e){return e.pipelines})),je=fe.actions,Oe=je.setPipeline,he=je.addEdge,ve=je.removeEdge,ge=fe.reducer,ye=n(33),me=n(71),xe=n.n(me),ke=n(61),we=n(38),Pe=n(25),De=function(e){return"in://".concat(e)},Ie=function(e){return"out://".concat(e)},Te=function(e){Object(H.a)(n,e);var t=Object(J.a)(n);function n(e){return Object(P.a)(this,n),t.call(this,Object(z.a)({alignment:e.in?Pe.PortModelAlignment.LEFT:Pe.PortModelAlignment.RIGHT,type:"default"},e))}return Object(D.a)(n,[{key:"deserialize",value:function(e){Object(ke.a)(Object(we.a)(n.prototype),"deserialize",this).call(this,e),this.options.in=e.data.in,this.options.label=e.data.label,this.options.portType=e.data.portType}},{key:"serialize",value:function(){return Object(z.a)(Object(z.a)({},Object(ke.a)(Object(we.a)(n.prototype),"serialize",this).call(this)),{},{in:this.options.in,label:this.options.label,portType:this.options.portType})}},{key:"link",value:function(e,t){var n=this.createLinkModel(t);return n.setSourcePort(this),n.setTargetPort(e),n}},{key:"canLinkToPort",value:function(e){return!(e instanceof n)||this.options.in!==e.getOptions().in}},{key:"createLinkModel",value:function(e){var t=Object(ke.a)(Object(we.a)(n.prototype),"createLinkModel",this).call(this);return!t&&e?e.generateModel({}):t||new me.DefaultLinkModel}}]),n}(Pe.PortModel),Se=function(e){Object(H.a)(n,e);var t=Object(J.a)(n);function n(e,a){var o,s,c;if(Object(P.a)(this,n),e.type===r.Operator)s="".concat(x(e.id)," - ").concat(e.image),c="rgb(0,192,255)";else{if(e.type!==r.Display)throw new Error("Unknown node type");s="".concat(x(e.id)," - Display (").concat(e.display,")"),c="rgb(255,192,0)"}if((o=t.call(this,{id:e.id,type:"oremda",name:s,color:c})).portsIn=void 0,o.portsOut=void 0,o.pipelineNode=void 0,o.portsOut={},o.portsIn={},e.type===r.Operator&&a){for(var u=0,d=Object.entries(a.ports.input);u<d.length;u++){var l=Object(F.a)(d[u],2),p=l[0],f=l[1];o.addInPort(p,f.type)}for(var b=0,j=Object.entries(a.ports.output);b<j.length;b++){var O=Object(F.a)(j[b],2),h=O[0],v=O[1];o.addOutPort(h,v.type)}}else e.type===r.Display&&o.addInPort("in",i.Display);return o.pipelineNode=e,o}return Object(D.a)(n,[{key:"doClone",value:function(e,t){t.portsIn={},t.portsOut={},Object(ke.a)(Object(we.a)(n.prototype),"doClone",this).call(this,e,t)}},{key:"removePort",value:function(e){Object(ke.a)(Object(we.a)(n.prototype),"removePort",this).call(this,e),e.getOptions().in?delete this.portsIn[e.getID()]:delete this.portsOut[e.getID()]}},{key:"addPort",value:function(e){return Object(ke.a)(Object(we.a)(n.prototype),"addPort",this).call(this,e),e.getOptions().in?void 0===this.portsIn[e.getID()]&&(this.portsIn[e.getID()]=e):void 0===this.portsOut[e.getID()]&&(this.portsOut[e.getID()]=e),e}},{key:"addInPort",value:function(e,t){var n=De(e),r=new Te({in:!0,id:n,name:n,label:e,alignment:Pe.PortModelAlignment.LEFT,portType:t});return this.addPort(r)}},{key:"addOutPort",value:function(e,t){var n=Ie(e),r=new Te({in:!1,id:n,name:n,label:e,alignment:Pe.PortModelAlignment.RIGHT,portType:t});return this.addPort(r)}},{key:"getInPort",value:function(e){var t=De(e);return this.getPort(t)}},{key:"getOutPort",value:function(e){var t=Ie(e);return this.getPort(t)}},{key:"deserialize",value:function(e){var t=this;Object(ke.a)(Object(we.a)(n.prototype),"deserialize",this).call(this,e),this.options.name=e.data.name,this.options.color=e.data.color,this.portsIn=e.data.portsInOrder.reduce((function(e,n){var r=t.getPortFromID(n);return r&&(e[n]=r),e}),{}),this.portsOut=e.data.portsOutOrder.reduce((function(e,n){var r=t.getPortFromID(n);return r&&(e[n]=r),e}),{})}},{key:"serialize",value:function(){return Object(z.a)(Object(z.a)({},Object(ke.a)(Object(we.a)(n.prototype),"serialize",this).call(this)),{},{name:this.options.name,color:this.options.color,portsInOrder:Object.values(this.portsIn).map((function(e){return e.getID()})),portsOutOrder:Object.values(this.portsOut).map((function(e){return e.getID()}))})}},{key:"getInPorts",value:function(){return this.portsIn}},{key:"getOutPorts",value:function(){return this.portsOut}}]),n}(Pe.NodeModel),Ne=n(26),Le=n(16);function Ee(e){return void 0!==e&&null!==e}(de=ue||(ue={})).Node=Le.default.div(ee||(ee=Object(Ne.a)(["\n\t\tbackground-color: ",";\n\t\tborder-radius: 5px;\n\t\tfont-family: sans-serif;\n\t\tcolor: white;\n\t\tborder: solid 2px black;\n\t\toverflow: visible;\n\t\tfont-size: 11px;\n\t\tborder: solid 2px ",";\n\t\tmin-width: 150px;\n\t"])),(function(e){return e.background}),(function(e){return e.selected?"rgb(0,192,255)":"black"})),de.Title=Le.default.div(te||(te=Object(Ne.a)(["\n\t\tbackground: rgba(0, 0, 0, 0.3);\n\t\tdisplay: flex;\n\t\twhite-space: nowrap;\n\t\tjustify-items: center;\n\t"]))),de.TitleName=Le.default.div(ne||(ne=Object(Ne.a)(["\n\t\tflex-grow: 1;\n\t\tpadding: 5px 5px;\n\t"]))),de.Ports=Le.default.div(re||(re=Object(Ne.a)(["\n\t\tdisplay: flex;\n\t\tbackground-image: linear-gradient(rgba(0, 0, 0, 0.1), rgba(0, 0, 0, 0.2));\n\t"]))),de.PortsContainer=Le.default.div(ae||(ae=Object(Ne.a)(["\n\t\tflex-grow: 1;\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\t&:first-of-type {\n\t\t\tmargin-right: 10px;\n\t\t}\n\t\t&:only-child {\n\t\t\tmargin-right: 0px;\n\t\t}\n\t"]))),de.Params=Le.default.div(ie||(ie=Object(Ne.a)(["\n    flex-grow: 1;\n    padding: 5px;\n    color: black;\n\t\tbackground-image: linear-gradient(rgba(255, 255, 255, 0.5), rgba(255, 255, 255, 0.5));\n\t"]))),de.ParamContainer=Le.default.div(oe||(oe=Object(Ne.a)([""]))),de.ParamName=Le.default.span(se||(se=Object(Ne.a)(["\n    font-weight: 700;\n  "]))),de.ParamValue=Le.default.span(ce||(ce=Object(Ne.a)([""])));var Ce,Re=function(e){Object(H.a)(n,e);var t=Object(J.a)(n);function n(){var e;Object(P.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).generatePort=function(t){return Object(M.jsx)(Me,{engine:e.props.engine,port:t},t.getID())},e}return Object(D.a)(n,[{key:"render",value:function(){return Object(M.jsxs)(ue.Node,{"data-default-node-name":this.props.node.getOptions().name,selected:this.props.node.isSelected(),background:this.props.node.getOptions().color,children:[Object(M.jsx)(ue.Title,{children:Object(M.jsx)(ue.TitleName,{children:this.props.node.getOptions().name})}),Object(M.jsxs)(ue.Ports,{children:[Object(M.jsx)(ue.PortsContainer,{children:Object.values(this.props.node.getInPorts()).map(this.generatePort)}),Object(M.jsx)(ue.PortsContainer,{children:Object.values(this.props.node.getOutPorts()).map(this.generatePort)})]}),Object(M.jsx)(ue.Params,{children:Object.entries(this.props.node.pipelineNode.params).map((function(e){var t=Object(F.a)(e,2),n=t[0],r=t[1];return Object(M.jsxs)(ue.ParamContainer,{children:[Object(M.jsx)(ue.ParamName,{children:"".concat(n,": ")}),Object(M.jsx)(ue.ParamValue,{children:(Ee(r)?r:"").toString()})]},n)}))})]})}}]),n}(s.a.Component);(Ce=ue||(ue={})).PortLabel=Le.default.div($||($=Object(Ne.a)(["\n\t\tdisplay: flex;\n\t\tmargin-top: 1px;\n\t\talign-items: center;\n\t"]))),Ce.InLabel=Le.default.div(Q||(Q=Object(Ne.a)(["\n\t\tpadding: 0 5px;\n\t\tflex-grow: 1;\n\t"]))),Ce.OutLabel=Le.default.div(X||(X=Object(Ne.a)(["\n\t\tpadding: 0 5px;\n\t\tflex-grow: 1;\n\t\ttext-align: right;\n\t"]))),Ce.Port=Le.default.div(Z||(Z=Object(Ne.a)(["\n\t\twidth: 15px;\n\t\theight: 15px;\n\t\tbackground: rgba(255, 255, 255, 0.1);\n\t\t&:hover {\n\t\t\tbackground: rgb(192, 255, 0);\n\t\t}\n\t"])));var Me=function(e){Object(H.a)(n,e);var t=Object(J.a)(n);function n(){return Object(P.a)(this,n),t.apply(this,arguments)}return Object(D.a)(n,[{key:"render",value:function(){var e=this.props.port.getOptions().portType,t=this.props.port.getOptions().in,n="base-port ";e===i.Display?n+="display-port":e===i.Binary?n+="display-binary":n+="data-port";var r=Object(M.jsx)(Pe.PortWidget,{engine:this.props.engine,port:this.props.port,className:n,children:Object(M.jsx)(ue.Port,{})}),a=t?ue.InLabel:ue.OutLabel,o=Object(M.jsx)(a,{children:this.props.port.getOptions().label});return Object(M.jsxs)(ue.PortLabel,{children:[this.props.port.getOptions().in?r:o,this.props.port.getOptions().in?o:r]})}}]),n}(s.a.Component),Be=n(17),Ue=function(e){Object(H.a)(n,e);var t=Object(J.a)(n);function n(){return Object(P.a)(this,n),t.call(this,"oremda")}return Object(D.a)(n,[{key:"generateReactWidget",value:function(e){return Object(M.jsx)(Re,{engine:this.engine,node:e.model})}},{key:"generateModel",value:function(e){return new Se({id:"",type:r.Operator,params:{},display:a.OneD})}}]),n}(Be.AbstractReactFactory);var Ae=function(e){var t=e.pipeline,n=e.operators,a=l(),i=Object(o.useState)(0),s=Object(F.a)(i,2),c=s[0],u=s[1],d=Object(o.useRef)(function(){var e=xe()();return e.getNodeFactories().registerFactory(new Ue),e}()),p=Object(o.useRef)(!0),b=Object(o.useRef)(new me.DagreEngine({graph:{rankdir:"LR",align:"UL",ranker:"longest-path",nodesep:100,ranksep:50,edgesep:10,marginx:25,marginy:25}}));return Object(o.useEffect)((function(){if(d.current&&b.current){var e=d.current.getModel();e||(e=new me.DiagramModel);var i=e.getNodes(),o={};t.nodes.forEach((function(e,t){var a;e.type===r.Operator&&n&&(a=n[e.image]);var s,c=new Se(e,a),u=Object(f.a)(i);try{for(u.s();!(s=u.n()).done;){var d=s.value;if(d.getID()===c.getID()){c.setPosition(d.getPosition());break}}}catch(l){u.e(l)}finally{u.f()}o[e.id]=c}));var s=[];t.edges.forEach((function(e){var t=null,n=null;if(o[e.from.id]){var r=o[e.from.id],a=e.from.port,i=e.type;(t=r.getOutPort(a))||(t=r.addOutPort(a,i))}if(o[e.to.id]){var c=o[e.to.id],u=e.to.port,d=e.type;(n=c.getInPort(u))||(n=c.addInPort(u,d))}if(t&&n){var l=new me.DefaultLinkModel;l.setSourcePort(t),l.setTargetPort(n),s.push(l)}}));var l=e;l.getNodes().forEach((function(e){return l.removeNode(e)})),l.getLinks().forEach((function(e){return l.removeLink(e)})),l.addAll.apply(l,Object(ye.a)(Object.values(o)).concat(s)),d.current.setModel(l);var j=[],O=function(e,n){var r=e.getSourcePort(),i=e.getTargetPort();if(r&&i){var o=r.getOptions(),s=r.getParent(),c=i.getOptions(),u=i.getParent();if("delete"!==n){if("update"===n){if(o.portType!==c.portType)return void a(ve({pipelineId:t.id,edgeId:e.getID()}));var d={id:e.getID(),type:o.portType,from:{id:s.getID(),port:o.label},to:{id:u.getID(),port:c.label}};a(he({pipelineId:t.id,edge:d}))}}else a(ve({pipelineId:t.id,edgeId:e.getID()}))}},h={deregister:function(){},entityRemoved:function(e){var t=e.entity;O(t,"delete")},sourcePortChanged:function(e){var t=e.entity;O(t,"update")},targetPortChanged:function(e){var t=e.entity;O(t,"update")}},v={deregister:function(){},linksUpdated:function(e){var t=e.isCreated,n=e.link;t&&(O(n,"create"),n.registerListener(h),j.push([n,h]))}};e.registerListener(v),u(c+1);var g=p.current;return setTimeout((function(){g&&(p.current=!1,b.current.redistribute(l),d.current.repaintCanvas())}),0),function(){e.clearListeners(),e.getLinks().forEach((function(e){e.clearListeners()}))}}}),[t,n]),d.current&&d.current.getModel()?Object(M.jsx)("div",{style:{width:"100%",height:"100%"},onDrop:function(e){if(e.dataTransfer.getData("operator-node")){var n=(c=JSON.parse(e.dataTransfer.getData("operator-node"))).imageName,i=c.operator,o={id:Object(W.a)(),image:n,params:Object.entries(i.params).reduce((function(e,t){var n=Object(F.a)(t,2),r=n[0],a=n[1];return e[r]=a.default,e}),{}),type:r.Operator};n.startsWith("oremda/tiff_reader")&&(o.params.filename="data.tiff"),n.startsWith("oremda/gaussian_blur")&&(o.params.sigma=10),n.startsWith("oremda/crop2d")&&(o.params.bounds=[25,350,90,305]);var s=Object(q.a)(t,(function(e){e.nodes.push(o)}));a(Oe(s))}else if(e.dataTransfer.getData("display-node")){var c,u=(c=JSON.parse(e.dataTransfer.getData("display-node"))).displayType,d={id:Object(W.a)(),type:r.Display,display:u,params:{}},l=Object(q.a)(t,(function(e){e.nodes.push(d)}));a(Oe(l)),a(g({id:d.id,type:d.display}))}},onDragOver:function(e){e.preventDefault()},children:Object(M.jsx)(Be.CanvasWidget,{className:"pipeline-diagram",engine:d.current})}):null},_e=n(558),Fe=n(553),ze=n(557),We=n(560),qe=function(){var e=l(),t=p(be.selectAll),n=(p((function(e){return e.pipelines.status})),p((function(e){return e.session.currentSession}))),a=p((function(e){return e.operators.operators})),i=s.a.useState(null),o=Object(F.a)(i,2),c=o[0],u=o[1],d=Boolean(c),f=function(t){var n=t.currentTarget.dataset.pipeline;void 0!==n&&fetch(n).then((function(e){return e.json()})).then((function(t){t.id=t.id||Object(W.a)(),t.nodes=t.nodes.map((function(e){return Object(z.a)(Object(z.a)({},e),{},{type:e.type||r.Operator})})),e(Oe(t)),t.nodes.filter(m).forEach((function(t){e(g({id:t.id,type:t.display}))}))})),u(null)};return Object(M.jsxs)("div",{className:"pipelines-panel",children:[Object(M.jsxs)(We.a,{spacing:1,direction:"row",children:[Object(M.jsx)(_e.a,{variant:"contained",onClick:function(){return function(){var t={id:Object(W.a)(),nodes:[],edges:[]};e(Oe(t))}()},size:"small",children:"New Pipeline"}),Object(M.jsx)(_e.a,{id:"basic-button","aria-controls":"basic-menu","aria-haspopup":"true","aria-expanded":d?"true":void 0,onClick:function(e){u(e.currentTarget)},variant:"contained",size:"small",children:"Load Existing Pipeline"}),Object(M.jsxs)(Fe.a,{id:"basic-menu",anchorEl:c,open:d,onClose:function(){u(null)},MenuListProps:{"aria-labelledby":"basic-button"},children:[Object(M.jsx)(ze.a,{"data-pipeline":"pipeline_1d.json",onClick:f,children:"Background Subtraction"}),Object(M.jsx)(ze.a,{"data-pipeline":"pipeline_2d.json",onClick:f,children:"Gaussian Blur"}),Object(M.jsx)(ze.a,{"data-pipeline":"pipeline_peak.json",onClick:f,children:"Peak Fitting"}),Object(M.jsx)(ze.a,{onClick:f,children:"Nano particle Orientation"}),Object(M.jsx)(ze.a,{onClick:f,children:"Bragg Disc Detection"})]})]}),t.map((function(e){return Object(M.jsxs)(s.a.Fragment,{children:[Object(M.jsxs)("p",{children:[Object(M.jsx)("span",{children:"Pipeline"})," ",e.id.slice(-8)," ",Object(M.jsx)(_e.a,{variant:"contained",color:"success",onClick:function(){return function(e){n&&Y(n.id,e)}(e)},size:"small",children:"run"})]}),Object(M.jsx)("div",{className:"pipeline-container",children:Object(M.jsx)(Ae,{pipeline:e,operators:a})})]},e.id)}))]})},He=function(e){var t={imageName:e.imageName,operator:e.operator};return Object(M.jsx)("div",{draggable:!0,onDragStart:function(e){e.dataTransfer.setData("operator-node",JSON.stringify(t))},className:"operator-palette-item",children:e.imageName})},Je=function(e){var t={displayType:e.displayType};return Object(M.jsx)("div",{draggable:!0,onDragStart:function(e){e.dataTransfer.setData("display-node",JSON.stringify(t))},className:"operator-palette-item display-palette-item",children:"Display (".concat(e.displayType,")")})},Ge=function(e){return Object(M.jsx)("div",{className:"operator-pallet-container",children:e.children})},Ke=function(e){return e.operators?Object(M.jsxs)(Ge,{children:[[a.OneD,a.TwoD].map((function(e){return Object(M.jsx)(Je,{displayType:e},e)})),Object.entries(e.operators).map((function(e){var t=Object(F.a)(e,2),n=t[0],r=t[1];return Object(M.jsx)(He,{operator:r,imageName:n},n)}))]}):null},Ve=function(){var e=p((function(e){return e.operators.operators}));return Object(M.jsxs)("div",{className:"operators-panel",children:[Object(M.jsx)("h4",{children:"Operators"}),Object(M.jsx)(Ke,{operators:e})]})},Ye=function(){var e=p((function(e){return e.session.currentSession})),t=p((function(e){return e.websocket.status}));return Object(M.jsxs)("div",{children:[Object(M.jsxs)("span",{children:["Session ID: ",null===e||void 0===e?void 0:e.id]}),Object(M.jsxs)("span",{children:[" WS: ",t]})]})};var $e=Object(b.b)("websocket/connect",function(){var e=Object(S.a)(T.a.mark((function e(t,n){var r,a;return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.sessionId,e.next=3,V.ws({url:"ws",params:{sessionId:r}});case 3:a=e.sent,N(a);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),Qe=Object(b.d)({name:"websocket",initialState:{status:"disconnected"},reducers:{},extraReducers:function(e){e.addCase($e.pending,(function(e){e.status="connecting"})).addCase($e.rejected,(function(e){e.status="disconnected"})).addCase($e.fulfilled,(function(e,t){e.status="connected"}))}}).reducer;function Xe(e){var t={sessionId:e};return V.get({url:"operators",params:t}).then((function(e){return e.json()}))}var Ze={operators:void 0},et=Object(b.b)("operators/fetch",function(){var e=Object(S.a)(T.a.mark((function e(t,n){var r;return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.sessionId,e.next=3,Xe(r);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),tt=Object(b.d)({name:"operators",initialState:Ze,reducers:{setOperators:function(e,t){var n=t.payload;e.operators=n}},extraReducers:function(e){e.addCase(et.fulfilled,(function(e,t){e.operators=t.payload}))}}).reducer,nt={currentSession:void 0},rt=Object(b.b)("session/create",function(){var e=Object(S.a)(T.a.mark((function e(t,n){var r;return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,V.post({url:"sessions"}).then((function(e){return e.json()}));case 2:return r=e.sent,n.dispatch($e({sessionId:r.id})),n.dispatch(et({sessionId:r.id})),e.abrupt("return",r);case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),at=Object(b.d)({name:"session",initialState:nt,reducers:{setSession:function(e,t){e.currentSession=t.payload}},extraReducers:function(e){e.addCase(rt.fulfilled,(function(e,t){e.currentSession=t.payload}))}}),it=(at.actions.setSession,at.reducer),ot=n(273);var st=function(){var e=l();return Object(o.useEffect)((function(){e(rt())}),[e]),Object(M.jsxs)("div",{className:"app",children:[Object(M.jsx)("div",{className:"header"}),Object(M.jsx)("div",{className:"content",children:Object(M.jsxs)("div",{className:"inner-content",children:[Object(M.jsx)(Ve,{}),Object(M.jsxs)(ot.a,{className:"split",children:[Object(M.jsx)(qe,{}),Object(M.jsx)(_,{})]})]})}),Object(M.jsx)("div",{className:"footer",children:Object(M.jsx)(Ye,{})})]})},ct=Object(b.a)({reducer:{session:it,pipelines:ge,displays:y,operators:tt,websocket:Qe}});Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));u.a.render(Object(M.jsx)(s.a.StrictMode,{children:Object(M.jsx)(d.a,{store:ct,children:Object(M.jsx)(st,{})})}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[520,1,2]]]);
//# sourceMappingURL=main.2ef556d3.chunk.js.map